CREATE OR REPLACE PACKAGE BODY PCLUB.PKG_CC_CONSULTA IS

PROCEDURE ADMPSI_ESTADOCTACC(K_TIPOCLIENTE IN VARCHAR2,
                              K_TIPODOC IN VARCHAR2,
                              K_NRODOC IN VARCHAR2,
                              K_FECHAINI IN DATE,
                              K_FECHAFIN IN DATE,
                              CURSORESTADOCTA OUT SYS_REFCURSOR,
                              K_CODERROR  OUT NUMBER,
                              K_DESCERROR OUT VARCHAR2) IS

  P_TIPOCLIENTE VARCHAR(20);

  BEGIN

    IF K_TIPOCLIENTE='2' THEN
       OPEN CURSORESTADOCTA FOR
       --MOVIMIENTO
          SELECT /*+ STAR_TRANSFORMATION */ K.ADMPV_COD_CLI AS CODCLIENTE,'' AS SERVICIO,CO.ADMPV_DESC AS CONCEPTO,
          --K.ADMPN_PUNTOS AS PUNTOS,
          DECODE(SIGN(NVL(K.ADMPN_PUNTOS,0)),-1, NVL(K.ADMPN_PUNTOS,0)*-1,NVL(K.ADMPN_PUNTOS,0)) AS PUNTOS,
          CASE K.ADMPC_TPO_PUNTO WHEN 'C' THEN 'CLARO' WHEN 'I' THEN 'INTERBANK' ELSE 'CLARO' END AS TIPOPUNTO,
          CASE K.ADMPC_TPO_OPER WHEN 'E' THEN 'ENTRADA' ELSE 'SALIDA' END  AS TIPOOPER,
          K.ADMPD_FEC_TRANS AS FECHAASIG,
          DECODE(K.ADMPC_TPO_OPER,'E',ADD_MONTHS(K.ADMPD_FEC_TRANS,18),NULL) AS FECHA_VIG
          FROM PCLUB.ADMPT_CLIENTE C
          --INNER JOIN PCLUB.ADMPT_KARDEX K
      INNER JOIN PCLUB.VIEW_ADMPT_KARDEX K
          ON C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
          INNER JOIN PCLUB.ADMPT_CONCEPTO CO
          ON K.ADMPV_COD_CPTO=CO.ADMPV_COD_CPTO
          WHERE C.ADMPV_TIPO_DOC=K_TIPODOC AND C.ADMPV_NUM_DOC=K_NRODOC
          AND C.ADMPV_COD_TPOCL IN  (1,2)
          --AND C.ADMPC_ESTADO='A'
          AND K.ADMPV_COD_CPTO <>'14'
          AND K.ADMPV_COD_CPTO <>'15'
          AND K.ADMPV_COD_CPTO <>'7'
          AND K.ADMPV_COD_CPTO <>'11'
          AND K.ADMPV_COD_CPTO <>'12'
          AND K.ADMPV_COD_CPTO <>'13'
          AND K.ADMPV_COD_CPTO <>'26'
          AND K.ADMPV_COD_CPTO <>'82'
          AND K.ADMPD_FEC_TRANS>=K_FECHAINI
          AND K.ADMPD_FEC_TRANS<K_FECHAFIN+1

          UNION ALL
          -- CANJE

          SELECT /*+ STAR_TRANSFORMATION */ CODCLIENTE,'' AS SERVICIO,CONCEPTO,
          --SUM(PUNTOS) AS PUNTOS,
          DECODE(SIGN(NVL(SUM(PUNTOS),0)),-1, NVL(SUM(PUNTOS),0)*-1,NVL(SUM(PUNTOS),0)) AS PUNTOS,
          TIPOPUNTO,
          TIPOOPER,
          FECHAASIG,
          FECHA_VIG
          FROM
          (SELECT CA.ADMPV_ID_CANJE,C.ADMPV_COD_CLI AS CODCLIENTE,'CANJE' AS CONCEPTO,
                    CK.ADMPN_PUNTOS AS PUNTOS,
                    CASE K.ADMPC_TPO_PUNTO WHEN 'C' THEN 'CLARO' WHEN 'I' THEN 'INTERBANK' ELSE 'CLARO' END AS TIPOPUNTO,
                    'SALIDA' AS TIPOOPER,
                    CA.ADMPD_FEC_CANJE AS FECHAASIG,
                    NULL AS FECHA_VIG
          FROM PCLUB.ADMPT_CANJE CA
          INNER JOIN PCLUB.ADMPT_CLIENTE C
          ON CA.ADMPV_COD_CLI=C.ADMPV_COD_CLI
          INNER JOIN PCLUB.ADMPT_CANJEDT_KARDEX CK
          ON CA.ADMPV_ID_CANJE=CK.ADMPV_ID_CANJE
          --INNER JOIN PCLUB.ADMPT_KARDEX K
      INNER JOIN PCLUB.VIEW_ADMPT_KARDEX K
          ON CK.ADMPN_ID_KARDEX=K.ADMPN_ID_KARDEX
          WHERE C.ADMPV_COD_TPOCL IN (1,2)
          AND C.ADMPV_TIPO_DOC=K_TIPODOC
          AND C.ADMPV_NUM_DOC=K_NRODOC
          --AND C.ADMPC_ESTADO='A'
          AND CA.ADMPC_TPO_OPER='C'
          AND CA.ADMPD_FEC_CANJE>=K_FECHAINI
          AND CA.ADMPD_FEC_CANJE<=K_FECHAFIN
          )
          GROUP BY ADMPV_ID_CANJE,CODCLIENTE,CONCEPTO,TIPOPUNTO,TIPOOPER,FECHAASIG,FECHA_VIG

          UNION ALL
--DEVOLUCION

          SELECT /*+ STAR_TRANSFORMATION */ CODCLIENTE,'' AS SERVICIO,CONCEPTO,
          --SUM(PUNTOS) AS PUNTOS,
           DECODE(SIGN(NVL(SUM(PUNTOS),0)),-1, NVL(SUM(PUNTOS),0)*-1,NVL(SUM(PUNTOS),0)) AS PUNTOS,
           TIPOPUNTO,TIPOOPER,FECHAASIG,FECHA_VIG FROM
          (
          SELECT DEV.ADMPV_ID_CANJE,
          C.ADMPV_COD_CLI AS CODCLIENTE, 'DEVOLUCION' AS CONCEPTO ,
                    CK.ADMPN_PUNTOS AS PUNTOS,
                    CASE K.ADMPC_TPO_PUNTO WHEN 'C' THEN 'CLARO' WHEN 'I' THEN 'INTERBANK' ELSE 'CLARO' END AS TIPOPUNTO,
                    'ENTRADA' AS TIPOOPER,
                    CA.ADMPD_FEC_CANJE AS FECHAASIG,
                    NULL AS FECHA_VIG
          FROM PCLUB.ADMPT_CANJE CA
          INNER JOIN PCLUB.ADMPT_CLIENTE C
          ON CA.ADMPV_COD_CLI=C.ADMPV_COD_CLI
          INNER JOIN PCLUB.ADMPT_CANJE DEV
          ON CA.ADMPV_DEV_IDCANJE=DEV.ADMPV_ID_CANJE
          INNER JOIN PCLUB.ADMPT_CANJEDT_KARDEX CK
          ON DEV.ADMPV_ID_CANJE=CK.ADMPV_ID_CANJE
          --INNER JOIN PCLUB.ADMPT_KARDEX K
      INNER JOIN PCLUB.VIEW_ADMPT_KARDEX K
          ON CK.ADMPN_ID_KARDEX=K.ADMPN_ID_KARDEX
          WHERE C.ADMPV_COD_TPOCL IN (1,2)
          AND C.ADMPV_TIPO_DOC=K_TIPODOC
          AND C.ADMPV_NUM_DOC=K_NRODOC
          --AND C.ADMPC_ESTADO='A'
          AND CA.ADMPC_TPO_OPER='D'
          AND CA.ADMPD_FEC_CANJE>=K_FECHAINI
          AND CA.ADMPD_FEC_CANJE<=K_FECHAFIN
          )
          GROUP BY ADMPV_ID_CANJE,CODCLIENTE,CONCEPTO,TIPOPUNTO,TIPOOPER,FECHAASIG,FECHA_VIG

          UNION ALL

          SELECT /*+ STAR_TRANSFORMATION */ K.ADMPV_COD_CLI AS CODCLIENTE, '' AS SERVICIO,'PRONTO PAGO' AS CONCEPTO,
          --SUM(K.ADMPN_PUNTOS) AS PUNTOS,
           DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0)) AS PUNTOS,
          'CLARO' AS TIPOPTO,
          'ENTRADA' AS TIPOOPER,
          K.ADMPD_FEC_TRANS AS FECHAASIG,
          ADD_MONTHS(K.ADMPD_FEC_TRANS,18) AS FECHA_VIG
          FROM PCLUB.ADMPT_CLIENTE C
          --INNER JOIN PCLUB.ADMPT_KARDEX K
      INNER JOIN PCLUB.VIEW_ADMPT_KARDEX K
          ON C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
          WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC AND C.ADMPV_NUM_DOC=K_NRODOC
          AND C.ADMPV_COD_TPOCL IN (1,2)
          --AND C.ADMPC_ESTADO='A'
          AND K.ADMPV_COD_CPTO IN ('7','11')
           AND K.ADMPD_FEC_TRANS>=K_FECHAINI
          AND K.ADMPD_FEC_TRANS< K_FECHAFIN +1
          GROUP BY K.ADMPV_COD_CLI ,K.ADMPD_FEC_TRANS

          UNION ALL

          SELECT /*+ STAR_TRANSFORMATION */ K.ADMPV_COD_CLI AS CODCLIENTE, '' AS SERVICIO,'FACTURACION' AS CONCEPTO,
          --SUM(K.ADMPN_PUNTOS) AS PUNTOS,
           DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0)) AS PUNTOS,
          'CLARO' AS TIPOPTO,
          'ENTRADA' AS TIPOOPER,
          K.ADMPD_FEC_TRANS AS FECHAASIG,
          ADD_MONTHS(K.ADMPD_FEC_TRANS,18) AS FECHA_VIG
          FROM PCLUB.ADMPT_CLIENTE C
          --INNER JOIN PCLUB.ADMPT_KARDEX K
      INNER JOIN PCLUB.VIEW_ADMPT_KARDEX K
          ON C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
          WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC AND C.ADMPV_NUM_DOC=K_NRODOC
          AND C.ADMPV_COD_TPOCL IN (1,2)
          --AND C.ADMPC_ESTADO='A'
          AND K.ADMPV_COD_CPTO IN ('12','13','26')
           AND K.ADMPD_FEC_TRANS>=K_FECHAINI
          AND K.ADMPD_FEC_TRANS< K_FECHAFIN +1
          GROUP BY K.ADMPV_COD_CLI ,K.ADMPD_FEC_TRANS

          ORDER BY FECHAASIG DESC, CONCEPTO ASC;

       ELSIF K_TIPOCLIENTE='3' THEN
          OPEN CURSORESTADOCTA FOR
--MOVIMIENTO
          SELECT /*+ STAR_TRANSFORMATION */ K.ADMPV_COD_CLI AS CODCLIENTE,'' AS SERVICIO,CO.ADMPV_DESC AS CONCEPTO,
          --K.ADMPN_PUNTOS AS PUNTOS,
          DECODE(SIGN(NVL(K.ADMPN_PUNTOS,0)),-1, NVL(K.ADMPN_PUNTOS,0)*-1,NVL(K.ADMPN_PUNTOS,0)) AS PUNTOS,
          CASE K.ADMPC_TPO_PUNTO WHEN 'C' THEN 'CLARO' WHEN 'B' THEN 'BONO' WHEN 'I' THEN 'INTERBANK' ELSE 'CLARO' END AS TIPOPUNTO,
          CASE K.ADMPC_TPO_OPER WHEN 'E' THEN 'ENTRADA' ELSE 'SALIDA' END  AS TIPOOPER,
          K.ADMPD_FEC_TRANS AS FECHAASIG,
          --DECODE(K.ADMPC_TPO_OPER,'E',ADD_MONTHS(K.ADMPD_FEC_TRANS,18),NULL) AS FECHA_VIG
          CASE K.ADMPC_TPO_PUNTO WHEN 'B' THEN K.ADMPD_FEC_VCMTO ELSE DECODE(K.ADMPC_TPO_OPER,'E',ADD_MONTHS(K.ADMPD_FEC_TRANS,18),NULL) END AS FECHA_VIG
          FROM PCLUB.ADMPT_CLIENTE C
          --INNER JOIN PCLUB.ADMPT_KARDEX K
      INNER JOIN PCLUB.VIEW_ADMPT_KARDEX K
          ON C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
          INNER JOIN PCLUB.ADMPT_CONCEPTO CO
          ON K.ADMPV_COD_CPTO=CO.ADMPV_COD_CPTO
          WHERE C.ADMPV_TIPO_DOC=K_TIPODOC AND C.ADMPV_NUM_DOC=K_NRODOC
          AND C.ADMPV_COD_TPOCL=K_TIPOCLIENTE
          --AND C.ADMPC_ESTADO='A'
          AND K.ADMPV_COD_CPTO <>'14'
          AND K.ADMPV_COD_CPTO <>'15'
          AND K.ADMPV_COD_CPTO <>'7'
          AND K.ADMPV_COD_CPTO <>'11'
          AND K.ADMPV_COD_CPTO <>'12'
          AND K.ADMPV_COD_CPTO <>'13'
          AND K.ADMPV_COD_CPTO <>'26'
          AND K.ADMPV_COD_CPTO <>'82'
          AND K.ADMPD_FEC_TRANS>=K_FECHAINI
          AND K.ADMPD_FEC_TRANS< K_FECHAFIN+1

          UNION ALL
  -- CANJE

          SELECT /*+ STAR_TRANSFORMATION */ CODCLIENTE,'' AS SERVICIO,CONCEPTO,
          --SUM(PUNTOS) AS PUNTOS,
          DECODE(SIGN(NVL(SUM(PUNTOS),0)),-1, NVL(SUM(PUNTOS),0)*-1,NVL(SUM(PUNTOS),0)) AS PUNTOS,
          TIPOPUNTO,
          TIPOOPER,
          FECHAASIG,
          FECHA_VIG
          FROM
          (SELECT CA.ADMPV_ID_CANJE,C.ADMPV_COD_CLI AS CODCLIENTE,'CANJE' AS CONCEPTO,
                    CK.ADMPN_PUNTOS AS PUNTOS,
                    CASE K.ADMPC_TPO_PUNTO WHEN 'C' THEN 'CLARO' WHEN 'I' THEN 'INTERBANK' ELSE 'CLARO' END AS TIPOPUNTO,
                    'SALIDA' AS TIPOOPER,
                    CA.ADMPD_FEC_CANJE AS FECHAASIG,
                    NULL AS FECHA_VIG
          FROM PCLUB.ADMPT_CANJE CA
          INNER JOIN PCLUB.ADMPT_CLIENTE C
          ON CA.ADMPV_COD_CLI=C.ADMPV_COD_CLI
          INNER JOIN PCLUB.ADMPT_CANJEDT_KARDEX CK
          ON CA.ADMPV_ID_CANJE=CK.ADMPV_ID_CANJE
          --INNER JOIN PCLUB.ADMPT_KARDEX K
      INNER JOIN PCLUB.VIEW_ADMPT_KARDEX K
          ON CK.ADMPN_ID_KARDEX=K.ADMPN_ID_KARDEX
          WHERE C.ADMPV_COD_TPOCL=K_TIPOCLIENTE
          AND C.ADMPV_TIPO_DOC=K_TIPODOC
          AND C.ADMPV_NUM_DOC=K_NRODOC
          --AND C.ADMPC_ESTADO='A'
          AND CA.ADMPC_TPO_OPER='C'
          AND CA.ADMPD_FEC_CANJE>=K_FECHAINI
          AND CA.ADMPD_FEC_CANJE<=K_FECHAFIN
          )
GROUP BY ADMPV_ID_CANJE,CODCLIENTE,CONCEPTO,TIPOPUNTO,TIPOOPER,FECHAASIG,FECHA_VIG

          UNION ALL
--DEVOLUCION

          SELECT /*+ STAR_TRANSFORMATION */ CODCLIENTE,'' AS SERVICIO,CONCEPTO,
          --SUM(PUNTOS) AS PUNTOS,
           DECODE(SIGN(NVL(SUM(PUNTOS),0)),-1, NVL(SUM(PUNTOS),0)*-1,NVL(SUM(PUNTOS),0)) AS PUNTOS,
           TIPOPUNTO,TIPOOPER,FECHAASIG,FECHA_VIG FROM
          (
          SELECT DEV.ADMPV_ID_CANJE,
          C.ADMPV_COD_CLI AS CODCLIENTE, 'DEVOLUCION' AS CONCEPTO ,
                    CK.ADMPN_PUNTOS AS PUNTOS,
                    CASE K.ADMPC_TPO_PUNTO WHEN 'C' THEN 'CLARO' WHEN 'I' THEN 'INTERBANK' ELSE 'CLARO' END AS TIPOPUNTO,
                    'ENTRADA' AS TIPOOPER,
                    CA.ADMPD_FEC_CANJE AS FECHAASIG,
                    NULL AS FECHA_VIG
          FROM PCLUB.ADMPT_CANJE CA
          INNER JOIN PCLUB.ADMPT_CLIENTE C
          ON CA.ADMPV_COD_CLI=C.ADMPV_COD_CLI
          INNER JOIN PCLUB.ADMPT_CANJE DEV
          ON CA.ADMPV_DEV_IDCANJE=DEV.ADMPV_ID_CANJE
          INNER JOIN PCLUB.ADMPT_CANJEDT_KARDEX CK
          ON DEV.ADMPV_ID_CANJE=CK.ADMPV_ID_CANJE
          --INNER JOIN PCLUB.ADMPT_KARDEX K
      INNER JOIN PCLUB.VIEW_ADMPT_KARDEX K
          ON CK.ADMPN_ID_KARDEX=K.ADMPN_ID_KARDEX
          WHERE C.ADMPV_COD_TPOCL=K_TIPOCLIENTE
          AND C.ADMPV_TIPO_DOC=K_TIPODOC
          AND C.ADMPV_NUM_DOC=K_NRODOC
          --AND C.ADMPC_ESTADO='A'
          AND CA.ADMPC_TPO_OPER='D'
          AND CA.ADMPD_FEC_CANJE>=K_FECHAINI
          AND CA.ADMPD_FEC_CANJE<=K_FECHAFIN
          )
          GROUP BY ADMPV_ID_CANJE,CODCLIENTE,CONCEPTO,TIPOPUNTO,TIPOOPER,FECHAASIG,FECHA_VIG

          UNION ALL

          SELECT /*+ STAR_TRANSFORMATION */ K.ADMPV_COD_CLI AS CODCLIENTE,'' AS SERVICIO, 'PRONTO PAGO' AS CONCEPTO,
          --SUM(K.ADMPN_PUNTOS) AS PUNTOS,
           DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0)) AS PUNTOS,
          'CLARO' AS TIPOPTO,
          'ENTRADA' AS TIPOOPER,
          K.ADMPD_FEC_TRANS AS FECHAASIG,
          ADD_MONTHS(K.ADMPD_FEC_TRANS,18) AS FECHA_VIG
          FROM PCLUB.ADMPT_CLIENTE C
          --INNER JOIN PCLUB.ADMPT_KARDEX K
      INNER JOIN PCLUB.VIEW_ADMPT_KARDEX K
          ON C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
          WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC AND C.ADMPV_NUM_DOC=K_NRODOC
          AND C.ADMPV_COD_TPOCL=K_TIPOCLIENTE
          --AND C.ADMPC_ESTADO='A'
          AND K.ADMPV_COD_CPTO IN ('7','11')
           AND K.ADMPD_FEC_TRANS>=K_FECHAINI
          AND K.ADMPD_FEC_TRANS< K_FECHAFIN + 1
          GROUP BY K.ADMPV_COD_CLI ,K.ADMPD_FEC_TRANS

          UNION ALL

          SELECT /*+ STAR_TRANSFORMATION */ K.ADMPV_COD_CLI AS CODCLIENTE,'' AS SERVICIO,'FACTURACION' AS CONCEPTO,
          --SUM(K.ADMPN_PUNTOS) AS PUNTOS,
           DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0)) AS PUNTOS,
          'CLARO' AS TIPOPTO,
          'ENTRADA' AS TIPOOPER,
          K.ADMPD_FEC_TRANS AS FECHAASIG,
          ADD_MONTHS(K.ADMPD_FEC_TRANS,18) AS FECHA_VIG
          FROM PCLUB.ADMPT_CLIENTE C
          --INNER JOIN PCLUB.ADMPT_KARDEX K
      INNER JOIN PCLUB.VIEW_ADMPT_KARDEX K
          ON C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
          WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC AND C.ADMPV_NUM_DOC=K_NRODOC
          AND C.ADMPV_COD_TPOCL=K_TIPOCLIENTE
          --AND C.ADMPC_ESTADO='A'
          AND K.ADMPV_COD_CPTO IN ('12','13','26')
           AND K.ADMPD_FEC_TRANS>=K_FECHAINI
          AND K.ADMPD_FEC_TRANS< K_FECHAFIN + 1
          GROUP BY K.ADMPV_COD_CLI ,K.ADMPD_FEC_TRANS

          ORDER BY FECHAASIG DESC, CONCEPTO ASC;

        ELSIF K_TIPOCLIENTE='6' THEN
       OPEN CURSORESTADOCTA FOR
       --MOVIMIENTOS
          SELECT /*+ STAR_TRANSFORMATION */ C.ADMPV_COD_CLI AS CODCLIENTE,TS.ADMPV_DESC AS SERVICIO,CO.ADMPV_DESC AS CONCEPTO,
          --K.ADMPN_PUNTOS AS PUNTOS,
          DECODE(SIGN(NVL(K.ADMPN_PUNTOS,0)),-1, NVL(K.ADMPN_PUNTOS,0)*-1,NVL(K.ADMPN_PUNTOS,0)) AS PUNTOS,
          CASE K.ADMPC_TPO_PUNTO WHEN 'C' THEN 'CLARO' WHEN 'I' THEN 'INTERBANK' ELSE 'CLARO' END AS TIPOPUNTO,
          CASE K.ADMPC_TPO_OPER WHEN 'E' THEN 'ENTRADA' ELSE 'SALIDA' END  AS TIPOOPER,
          K.ADMPD_FEC_TRANS AS FECHAASIG,
          DECODE(K.ADMPC_TPO_OPER,'E',ADD_MONTHS(K.ADMPD_FEC_TRANS,18),NULL) AS FECHA_VIG
          FROM PCLUB.ADMPT_CLIENTEFIJA C
          INNER JOIN PCLUB.ADMPT_CLIENTEPRODUCTO P
          ON C.ADMPV_COD_CLI=P.ADMPV_COD_CLI
          INNER JOIN PCLUB.ADMPT_KARDEXFIJA K
          ON P.ADMPV_COD_CLI_PROD=K.ADMPV_COD_CLI_PROD
          INNER JOIN PCLUB.ADMPT_CONCEPTO CO
          ON K.ADMPV_COD_CPTO=CO.ADMPV_COD_CPTO
          INNER JOIN PCLUB.ADMPT_TIPOSERV_DTH_HFC TS
          ON TS.ADMPV_SERVICIO=P.ADMPV_SERVICIO
          and ts.admpv_cod_tpocl=K_TIPOCLIENTE
          WHERE C.ADMPV_TIPO_DOC = K_TIPODOC AND C.ADMPV_NUM_DOC=K_NRODOC
          AND C.ADMPV_COD_TPOCL = K_TIPOCLIENTE
          --AND C.ADMPC_ESTADO='A'
          AND K.ADMPV_COD_CPTO NOT IN (64,65,82)--JCGT  --  AND K.ADMPV_COD_CPTO in(74,75,59,52,72,59,55,58,69,73,62,64,65)
          AND K.ADMPD_FEC_TRANS>=K_FECHAINI
          AND K.ADMPD_FEC_TRANS<K_FECHAFIN+1

          UNION ALL--JCGT INI
          SELECT /*+ STAR_TRANSFORMATION */ MAX(C.ADMPV_COD_CLI) AS CODCLIENTE,MAX(TS.ADMPV_DESC) AS SERVICIO,MAX(CO.ADMPV_DESC) AS CONCEPTO,
          SUM(DECODE(SIGN(NVL(K.ADMPN_PUNTOS,0)),-1, NVL(K.ADMPN_PUNTOS,0)*-1,NVL(K.ADMPN_PUNTOS,0))) AS PUNTOS,
          MAX(CASE K.ADMPC_TPO_PUNTO WHEN 'C' THEN 'CLARO' WHEN 'I' THEN 'INTERBANK' ELSE 'CLARO' END) AS TIPOPUNTO,
          MAX(CASE K.ADMPC_TPO_OPER WHEN 'E' THEN 'ENTRADA' ELSE 'SALIDA' END)  AS TIPOOPER,
          MAX(K.ADMPD_FEC_TRANS) AS FECHAASIG,
          MAX(DECODE(K.ADMPC_TPO_OPER,'E',ADD_MONTHS(K.ADMPD_FEC_TRANS,18),NULL)) AS FECHA_VIG
          FROM PCLUB.ADMPT_CLIENTEFIJA C
          INNER JOIN PCLUB.ADMPT_CLIENTEPRODUCTO P
          ON C.ADMPV_COD_CLI=P.ADMPV_COD_CLI
          INNER JOIN PCLUB.ADMPT_KARDEXFIJA K
          ON P.ADMPV_COD_CLI_PROD=K.ADMPV_COD_CLI_PROD
          INNER JOIN PCLUB.ADMPT_CONCEPTO CO
          ON K.ADMPV_COD_CPTO=CO.ADMPV_COD_CPTO
          INNER JOIN PCLUB.ADMPT_TIPOSERV_DTH_HFC TS
          ON TS.ADMPV_SERVICIO=P.ADMPV_SERVICIO
          and ts.admpv_cod_tpocl=K_TIPOCLIENTE
          WHERE C.ADMPV_TIPO_DOC = K_TIPODOC AND C.ADMPV_NUM_DOC=K_NRODOC
          AND C.ADMPV_COD_TPOCL = K_TIPOCLIENTE
          --AND C.ADMPC_ESTADO='A'
          AND K.ADMPV_COD_CPTO IN (64,65,82)--53,54,60,61,73,60,56,57,68,72,63,
          AND K.ADMPD_FEC_TRANS>=K_FECHAINI
          AND K.ADMPD_FEC_TRANS<K_FECHAFIN+1
          GROUP BY P.ADMPV_COD_CLI_PROD,K.ADMPV_COD_CPTO,TO_CHAR(K.ADMPD_FEC_TRANS,'DD/MM/YYYY')--JCGT INI

          ORDER BY FECHAASIG DESC, CONCEPTO ASC;

       ELSIF K_TIPOCLIENTE='7' THEN
       OPEN CURSORESTADOCTA FOR
       --MOVIMIENTOS
          SELECT /*+ STAR_TRANSFORMATION */ C.ADMPV_COD_CLI AS CODCLIENTE,TS.ADMPV_DESC AS SERVICIO,CO.ADMPV_DESC AS CONCEPTO,
          DECODE(SIGN(NVL(K.ADMPN_PUNTOS,0)),-1, NVL(K.ADMPN_PUNTOS,0)*-1,NVL(K.ADMPN_PUNTOS,0)) AS PUNTOS,
          CASE K.ADMPC_TPO_PUNTO WHEN 'C' THEN 'CLARO' WHEN 'I' THEN 'INTERBANK' ELSE 'CLARO' END AS TIPOPUNTO,
          CASE K.ADMPC_TPO_OPER WHEN 'E' THEN 'ENTRADA' ELSE 'SALIDA' END  AS TIPOOPER,
          K.ADMPD_FEC_TRANS AS FECHAASIG,
          DECODE(K.ADMPC_TPO_OPER,'E',ADD_MONTHS(K.ADMPD_FEC_TRANS,18),NULL) AS FECHA_VIG
          FROM PCLUB.ADMPT_CLIENTEFIJA C
          INNER JOIN PCLUB.ADMPT_CLIENTEPRODUCTO P
          ON C.ADMPV_COD_CLI=P.ADMPV_COD_CLI
          INNER JOIN PCLUB.ADMPT_KARDEXFIJA K
          ON P.ADMPV_COD_CLI_PROD=K.ADMPV_COD_CLI_PROD
          INNER JOIN PCLUB.ADMPT_CONCEPTO CO
          ON K.ADMPV_COD_CPTO=CO.ADMPV_COD_CPTO
          INNER JOIN PCLUB.ADMPT_TIPOSERV_DTH_HFC TS
          ON TS.ADMPV_SERVICIO=P.ADMPV_SERVICIO
          and ts.admpv_cod_tpocl=K_TIPOCLIENTE
          WHERE C.ADMPV_TIPO_DOC = K_TIPODOC AND C.ADMPV_NUM_DOC=K_NRODOC
          AND C.ADMPV_COD_TPOCL = K_TIPOCLIENTE
          --AND C.ADMPC_ESTADO='A'
          AND K.ADMPV_COD_CPTO NOT IN (66,67,82)--53,54,60,61,73,60,56,57,68,72,63,
          AND K.ADMPD_FEC_TRANS>=K_FECHAINI
          AND K.ADMPD_FEC_TRANS<K_FECHAFIN+1

          --ORDER BY FECHAASIG DESC, CONCEPTO ASC;
          UNION ALL
          SELECT /*+ STAR_TRANSFORMATION */ MAX(C.ADMPV_COD_CLI) AS CODCLIENTE,MAX(TS.ADMPV_DESC) AS SERVICIO,MAX(CO.ADMPV_DESC) AS CONCEPTO,
          SUM(DECODE(SIGN(NVL(K.ADMPN_PUNTOS,0)),-1, NVL(K.ADMPN_PUNTOS,0)*-1,NVL(K.ADMPN_PUNTOS,0))) AS PUNTOS,
          MAX(CASE K.ADMPC_TPO_PUNTO WHEN 'C' THEN 'CLARO' WHEN 'I' THEN 'INTERBANK' ELSE 'CLARO' END) AS TIPOPUNTO,
          MAX(CASE K.ADMPC_TPO_OPER WHEN 'E' THEN 'ENTRADA' ELSE 'SALIDA' END)  AS TIPOOPER,
          MAX(K.ADMPD_FEC_TRANS) AS FECHAASIG,
          MAX(DECODE(K.ADMPC_TPO_OPER,'E',ADD_MONTHS(K.ADMPD_FEC_TRANS,18),NULL)) AS FECHA_VIG
          FROM PCLUB.ADMPT_CLIENTEFIJA C
          INNER JOIN PCLUB.ADMPT_CLIENTEPRODUCTO P
          ON C.ADMPV_COD_CLI=P.ADMPV_COD_CLI
          INNER JOIN PCLUB.ADMPT_KARDEXFIJA K
          ON P.ADMPV_COD_CLI_PROD=K.ADMPV_COD_CLI_PROD
          INNER JOIN PCLUB.ADMPT_CONCEPTO CO
          ON K.ADMPV_COD_CPTO=CO.ADMPV_COD_CPTO
          INNER JOIN PCLUB.ADMPT_TIPOSERV_DTH_HFC TS
          ON TS.ADMPV_SERVICIO=P.ADMPV_SERVICIO
          and ts.admpv_cod_tpocl=K_TIPOCLIENTE
          WHERE C.ADMPV_TIPO_DOC = K_TIPODOC AND C.ADMPV_NUM_DOC=K_NRODOC
          AND C.ADMPV_COD_TPOCL = K_TIPOCLIENTE
          --AND C.ADMPC_ESTADO='A'
          AND K.ADMPV_COD_CPTO IN (66,67,82)--53,54,60,61,73,60,56,57,68,72,63,
          AND K.ADMPD_FEC_TRANS>=K_FECHAINI
          AND K.ADMPD_FEC_TRANS<K_FECHAFIN+1
          GROUP BY P.ADMPV_COD_CLI_PROD,K.ADMPV_COD_CPTO,TO_CHAR(K.ADMPD_FEC_TRANS,'DD/MM/YYYY')

           ORDER BY FECHAASIG DESC, CONCEPTO ASC;

      --TFI
      ELSIF K_TIPOCLIENTE='8' THEN
          OPEN CURSORESTADOCTA FOR
      --MOVIMIENTO
          SELECT /*+ STAR_TRANSFORMATION */ K.ADMPV_COD_CLI AS CODCLIENTE,'' AS SERVICIO,CO.ADMPV_DESC AS CONCEPTO,
          DECODE(SIGN(NVL(K.ADMPN_PUNTOS,0)),-1, NVL(K.ADMPN_PUNTOS,0)*-1,NVL(K.ADMPN_PUNTOS,0)) AS PUNTOS,
          CASE K.ADMPC_TPO_PUNTO WHEN 'C' THEN 'CLARO' WHEN 'I' THEN 'INTERBANK' ELSE 'CLARO' END AS TIPOPUNTO,
          CASE K.ADMPC_TPO_OPER WHEN 'E' THEN 'ENTRADA' ELSE 'SALIDA' END  AS TIPOOPER,
          K.ADMPD_FEC_TRANS AS FECHAASIG,
          DECODE(K.ADMPC_TPO_OPER,'E',ADD_MONTHS(K.ADMPD_FEC_TRANS,18),NULL) AS FECHA_VIG
          FROM  PCLUB.ADMPT_CLIENTE C
          --INNER JOIN PCLUB.ADMPT_KARDEX K
      INNER JOIN PCLUB.VIEW_ADMPT_KARDEX K
          ON C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
          INNER JOIN  PCLUB.ADMPT_CONCEPTO CO
          ON K.ADMPV_COD_CPTO=CO.ADMPV_COD_CPTO
          WHERE C.ADMPV_TIPO_DOC=K_TIPODOC AND C.ADMPV_NUM_DOC=K_NRODOC
          AND C.ADMPV_COD_TPOCL=K_TIPOCLIENTE
          --AND C.ADMPC_ESTADO='A'
          AND K.ADMPV_COD_CPTO <>'90' --CANJE
          AND K.ADMPV_COD_CPTO <>'91' --DEVOLUCION
          AND K.ADMPV_COD_CPTO <>'82' --CANJE VENTA
          AND K.ADMPD_FEC_TRANS>=K_FECHAINI
          AND K.ADMPD_FEC_TRANS< K_FECHAFIN+1

          UNION ALL
          -- CANJE
          SELECT /*+ STAR_TRANSFORMATION */ CODCLIENTE,'' AS SERVICIO,CONCEPTO,
          DECODE(SIGN(NVL(SUM(PUNTOS),0)),-1, NVL(SUM(PUNTOS),0)*-1,NVL(SUM(PUNTOS),0)) AS PUNTOS,
          TIPOPUNTO,
          TIPOOPER,
          FECHAASIG,
          FECHA_VIG
          FROM
          (SELECT CA.ADMPV_ID_CANJE,C.ADMPV_COD_CLI AS CODCLIENTE,'CANJE' AS CONCEPTO,
                    CK.ADMPN_PUNTOS AS PUNTOS,
                    CASE K.ADMPC_TPO_PUNTO WHEN 'C' THEN 'CLARO' WHEN 'I' THEN 'INTERBANK' ELSE 'CLARO' END AS TIPOPUNTO,
                    'SALIDA' AS TIPOOPER,
                    CA.ADMPD_FEC_CANJE AS FECHAASIG,
                    NULL AS FECHA_VIG
          FROM  PCLUB.ADMPT_CANJE CA
          INNER JOIN  PCLUB.ADMPT_CLIENTE C
          ON CA.ADMPV_COD_CLI=C.ADMPV_COD_CLI
          INNER JOIN  PCLUB.ADMPT_CANJEDT_KARDEX CK
          ON CA.ADMPV_ID_CANJE=CK.ADMPV_ID_CANJE
          --INNER JOIN PCLUB.ADMPT_KARDEX K
      INNER JOIN PCLUB.VIEW_ADMPT_KARDEX K
          ON CK.ADMPN_ID_KARDEX=K.ADMPN_ID_KARDEX
          WHERE C.ADMPV_COD_TPOCL=K_TIPOCLIENTE
          AND C.ADMPV_TIPO_DOC=K_TIPODOC
          AND C.ADMPV_NUM_DOC=K_NRODOC
          --AND C.ADMPC_ESTADO='A'
          AND CA.ADMPC_TPO_OPER='C'
          AND CA.ADMPD_FEC_CANJE>=K_FECHAINI
          AND CA.ADMPD_FEC_CANJE<=K_FECHAFIN
          )
GROUP BY ADMPV_ID_CANJE,CODCLIENTE,CONCEPTO,TIPOPUNTO,TIPOOPER,FECHAASIG,FECHA_VIG

          UNION ALL
          --DEVOLUCION
          SELECT /*+ STAR_TRANSFORMATION */ CODCLIENTE,'' AS SERVICIO,CONCEPTO,
          DECODE(SIGN(NVL(SUM(PUNTOS),0)),-1, NVL(SUM(PUNTOS),0)*-1,NVL(SUM(PUNTOS),0)) AS PUNTOS,
          TIPOPUNTO,TIPOOPER,FECHAASIG,FECHA_VIG FROM
          (
          SELECT DEV.ADMPV_ID_CANJE,
          C.ADMPV_COD_CLI AS CODCLIENTE, 'DEVOLUCION' AS CONCEPTO ,
                    CK.ADMPN_PUNTOS AS PUNTOS,
                    CASE K.ADMPC_TPO_PUNTO WHEN 'C' THEN 'CLARO' WHEN 'I' THEN 'INTERBANK' ELSE 'CLARO' END AS TIPOPUNTO,
                    'ENTRADA' AS TIPOOPER,
                    CA.ADMPD_FEC_CANJE AS FECHAASIG,
                    NULL AS FECHA_VIG
          FROM  PCLUB.ADMPT_CANJE CA
          INNER JOIN  PCLUB.ADMPT_CLIENTE C
          ON CA.ADMPV_COD_CLI=C.ADMPV_COD_CLI
          INNER JOIN  PCLUB.ADMPT_CANJE DEV
          ON CA.ADMPV_DEV_IDCANJE=DEV.ADMPV_ID_CANJE
          INNER JOIN  PCLUB.ADMPT_CANJEDT_KARDEX CK
          ON DEV.ADMPV_ID_CANJE=CK.ADMPV_ID_CANJE
          --INNER JOIN PCLUB.ADMPT_KARDEX K
      INNER JOIN PCLUB.VIEW_ADMPT_KARDEX K
          ON CK.ADMPN_ID_KARDEX=K.ADMPN_ID_KARDEX
          WHERE C.ADMPV_COD_TPOCL=K_TIPOCLIENTE
          AND C.ADMPV_TIPO_DOC=K_TIPODOC
          AND C.ADMPV_NUM_DOC=K_NRODOC
         -- AND C.ADMPC_ESTADO='A'
          AND CA.ADMPC_TPO_OPER='D'
          AND CA.ADMPD_FEC_CANJE>=K_FECHAINI
          AND CA.ADMPD_FEC_CANJE<=K_FECHAFIN
          )
          GROUP BY ADMPV_ID_CANJE,CODCLIENTE,CONCEPTO,TIPOPUNTO,TIPOOPER,FECHAASIG,FECHA_VIG

          ORDER BY FECHAASIG DESC, CONCEPTO ASC;
       END IF;

      K_CODERROR  := 0;
    K_DESCERROR := 'OK';

      EXCEPTION
        WHEN OTHERS THEN
      OPEN CURSORESTADOCTA FOR SELECT '' REGDES, '' PROVDES  FROM DUAL;
          K_CODERROR  := 1;
      K_DESCERROR := SUBSTR('ERROR : ' || SQLERRM,1,250);

  END ADMPSI_ESTADOCTACC;

  --****************************************************************
  -- Nombre SP           :  ADMPSI_PTOSACUMULADOS
  -- Propósito           :  permite listar el Total de los puntos Acumulados
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  --                        K_TIPOBOLSA
  -- Output              :  K_PTOSACUMULADOS
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
  --****************************************************************

PROCEDURE ADMPSI_PTOSACUMULADOS(K_TIPODOC IN VARCHAR2,
                                  K_NRODOC IN VARCHAR2,
                                  K_TIPOBOLSA  IN NUMBER,
                                  K_PTOSACUMULADOS OUT NUMBER,
                                  K_CODERROR  OUT NUMBER,
                                  K_DESCERROR OUT VARCHAR2)

   IS
   BEGIN

       IF K_TIPOBOLSA='2' THEN
          BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSACUMULADOS FROM
			   --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K
         , PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL IN (1,2)
               AND C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPV_COD_CPTO IN (8,9,17,47,12,13,26,7,11,1,4,76,77);
           EXCEPTION
           WHEN NO_DATA_FOUND THEN
           K_PTOSACUMULADOS:=0;
           END;

       ELSIF K_TIPOBOLSA='3' THEN
               BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSACUMULADOS FROM
			    --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K
         , PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               AND  C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPV_COD_CPTO IN (27,28,42,1,4,78,79,94,95,96,97,98,101,102);
               EXCEPTION
               WHEN NO_DATA_FOUND THEN
               K_PTOSACUMULADOS:=0;
               END;
       --DTH
       ELSIF K_TIPOBOLSA='6' THEN
       BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSACUMULADOS FROM PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEFIJA C, PCLUB.ADMPT_CLIENTEPRODUCTO P
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               --AND C.ADMPC_ESTADO='A'
               AND C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
               AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPV_COD_CPTO IN (74,75,59,52,72);
               EXCEPTION
               WHEN NO_DATA_FOUND THEN
               K_PTOSACUMULADOS:=0;
               END;
       --HFC
       ELSIF K_TIPOBOLSA='7' THEN
       BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSACUMULADOS FROM PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEFIJA C, PCLUB.ADMPT_CLIENTEPRODUCTO P
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               --AND C.ADMPC_ESTADO='A'
               AND C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
               AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPV_COD_CPTO IN (53,54,60,61,73);
               EXCEPTION
               WHEN NO_DATA_FOUND THEN
               K_PTOSACUMULADOS:=0;
               END;
       --TFI
       ELSIF K_TIPOBOLSA='8' THEN
       BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSACUMULADOS FROM   --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K,  PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               AND  C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPV_COD_CPTO IN (83,84,85,88);
               EXCEPTION
               WHEN NO_DATA_FOUND THEN
               K_PTOSACUMULADOS:=0;
               END;
       ELSE
               K_PTOSACUMULADOS:=0;
       END IF;

   K_CODERROR  := 0;

   EXCEPTION
        WHEN OTHERS THEN
          K_CODERROR  := 1;
          K_DESCERROR := 'NO OK';
          K_PTOSACUMULADOS:=0;
   END ADMPSI_PTOSACUMULADOS;


  --****************************************************************
  -- Nombre SP           :  ADMPSI_PTOSCANJEADOS
  -- Propósito           :  permite listar el Total de los puntos Canjeados
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  --                        K_TIPOBOLSA
  -- Output              :  K_PTOSCANJEADOS
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
  --****************************************************************
  PROCEDURE ADMPSI_PTOSCANJEADOS(
                                K_TIPODOC IN VARCHAR2,
                                K_NRODOC IN VARCHAR2,
                                K_TIPOBOLSA  IN NUMBER,
                                K_PTOSCANJEADOS OUT NUMBER,
                                K_CODERROR  OUT NUMBER,
                                K_DESCERROR OUT VARCHAR2
                                )
  IS
  V_PUNTOS1 NUMBER;
  V_PUNTOS2 NUMBER;
  BEGIN

   IF K_TIPOBOLSA='2' THEN
          BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO V_PUNTOS1 FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL IN (1,2)
               AND C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPV_COD_CPTO IN (14,8,82);
           EXCEPTION
           WHEN NO_DATA_FOUND THEN
           V_PUNTOS1:=0;
           END;

           BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO V_PUNTOS2 FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL IN (1,2)
               AND C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPV_COD_CPTO IN ('15','104');
           EXCEPTION
           WHEN NO_DATA_FOUND THEN
           V_PUNTOS2:=0;
           END;
           --TOTAL DE PUNTOS CANJEADOS
           SELECT NVL(V_PUNTOS1,0) - NVL(V_PUNTOS2,0) INTO K_PTOSCANJEADOS FROM DUAL;

       ELSIF K_TIPOBOLSA='3' THEN
           BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO V_PUNTOS1 FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               AND C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPV_COD_CPTO IN (14,42,82);
           EXCEPTION
           WHEN NO_DATA_FOUND THEN
           V_PUNTOS1:=0;
           END;

           BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO V_PUNTOS2 FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               AND C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPV_COD_CPTO IN ('15','104');
           EXCEPTION
           WHEN NO_DATA_FOUND THEN
           V_PUNTOS2:=0;
           END;
           --TOTAL DE PUNTOS CANJEADOS
           SELECT NVL(V_PUNTOS1,0) - NVL(V_PUNTOS2,0) INTO K_PTOSCANJEADOS FROM DUAL;
       --DTH
       ELSIF K_TIPOBOLSA='6' THEN
           -- salidas
           BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
                      INTO V_PUNTOS1 --K_PTOSCANJEADOS
               FROM PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEFIJA C, PCLUB.ADMPT_CLIENTEPRODUCTO P
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               --AND C.ADMPC_ESTADO='A'
               AND C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
               AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPV_COD_CPTO IN (59,55,82);
           EXCEPTION
           WHEN NO_DATA_FOUND THEN
             V_PUNTOS1 := 0; --K_PTOSCANJEADOS:=0;
           END;

           -- entradas
           BEGIN
             SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
                      INTO V_PUNTOS2 --K_PTOSCANJEADOS
               FROM PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEFIJA C, PCLUB.ADMPT_CLIENTEPRODUCTO P
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
                     AND C.ADMPV_NUM_DOC=K_NRODOC
                     AND C.ADMPV_COD_TPOCL=K_TIPOBOLSA
                     --AND C.ADMPC_ESTADO='A'
                     AND C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
                     AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
                     AND  K.ADMPC_TPO_OPER = 'E'
                     AND  K.ADMPV_COD_CPTO = '104';
           EXCEPTION
             WHEN NO_DATA_FOUND THEN
               V_PUNTOS2 := 0;
           END;

           --TOTAL DE PUNTOS CANJEADOS
           SELECT NVL(V_PUNTOS1,0) - NVL(V_PUNTOS2,0) INTO K_PTOSCANJEADOS
           FROM DUAL;
       --HFC
       ELSIF K_TIPOBOLSA='7' THEN
           -- salidas
           BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
                      INTO V_PUNTOS1 --K_PTOSCANJEADOS
               FROM PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEFIJA C, PCLUB.ADMPT_CLIENTEPRODUCTO P
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               --AND C.ADMPC_ESTADO='A'
               AND C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
               AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPV_COD_CPTO IN (60,56,82);
           EXCEPTION
             WHEN NO_DATA_FOUND THEN
               V_PUNTOS1 :=0; --K_PTOSCANJEADOS:=0;
           END;

           -- entradas
           BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
                      INTO V_PUNTOS2 --K_PTOSCANJEADOS
               FROM PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEFIJA C, PCLUB.ADMPT_CLIENTEPRODUCTO P
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
                     AND C.ADMPV_NUM_DOC=K_NRODOC
                     AND C.ADMPV_COD_TPOCL=K_TIPOBOLSA
                     --AND C.ADMPC_ESTADO='A'
                     AND C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
                     AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
                     AND  K.ADMPC_TPO_OPER = 'E'
                     AND  K.ADMPV_COD_CPTO = '104';
           EXCEPTION
             WHEN NO_DATA_FOUND THEN
               V_PUNTOS2 := 0; --K_PTOSCANJEADOS:=0;
           END;

           --TOTAL DE PUNTOS CANJEADOS
           SELECT NVL(V_PUNTOS1,0) - NVL(V_PUNTOS2,0) INTO K_PTOSCANJEADOS
           FROM DUAL;
       --TFI
       ELSIF K_TIPOBOLSA='8' THEN
           BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO V_PUNTOS1 FROM  --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K,  PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               AND C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPV_COD_CPTO IN(90,82);
           EXCEPTION
           WHEN NO_DATA_FOUND THEN
           V_PUNTOS1:=0;
           END;

           BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO V_PUNTOS2 FROM  --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K,  PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               AND C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPV_COD_CPTO IN ('91','104');
           EXCEPTION
           WHEN NO_DATA_FOUND THEN
           V_PUNTOS2:=0;
           END;
           --TOTAL DE PUNTOS CANJEADOS
           SELECT NVL(V_PUNTOS1,0) - NVL(V_PUNTOS2,0) INTO K_PTOSCANJEADOS FROM DUAL;
       ELSE
           K_PTOSCANJEADOS:=0;
       END IF;
  K_CODERROR:=0;
  EXCEPTION
        WHEN OTHERS THEN
          K_CODERROR  := 1;
          K_DESCERROR := 'NO OK';

  END ADMPSI_PTOSCANJEADOS;

  --****************************************************************
  -- Nombre SP           :  ADMPSI_PTOSELIMXBAJA
  -- Propósito           :  permite listar el Total de los puntos Eliminados x Baja
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  --                        K_TIPOBOLSA
  -- Output              :  K_PTOSELIMXBAJA
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
  --****************************************************************


  PROCEDURE ADMPSI_PTOSELIMXBAJA(K_TIPODOC IN VARCHAR2,
                                  K_NRODOC IN VARCHAR2,
                                  K_TIPOBOLSA  IN NUMBER,
                                  K_PTOSELIMXBAJA OUT NUMBER,
                                  K_CODERROR  OUT NUMBER,
                                  K_DESCERROR OUT VARCHAR2)

   IS
   V_PTOBAJASALIDA NUMBER;
   V_PTOBAJAENTRADA NUMBER;
   BEGIN

       IF K_TIPOBOLSA='2' THEN
          BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO V_PTOBAJASALIDA FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL IN (1,2)
               AND C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPV_COD_CPTO IN (19,20,21,2,47,9);

               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO V_PTOBAJAENTRADA FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL IN (1,2)
               AND C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPV_COD_CPTO IN (19);

               K_PTOSELIMXBAJA:=V_PTOBAJASALIDA - V_PTOBAJAENTRADA;

           EXCEPTION
           WHEN NO_DATA_FOUND THEN
           K_PTOSELIMXBAJA:=0;
           END;

       ELSIF K_TIPOBOLSA='3' THEN
           BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO V_PTOBAJASALIDA FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               AND  C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPV_COD_CPTO IN (30,31,32,2,100);


               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO V_PTOBAJAENTRADA FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               AND  C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPV_COD_CPTO IN (39);

               K_PTOSELIMXBAJA:=V_PTOBAJASALIDA - V_PTOBAJAENTRADA;
           EXCEPTION
           WHEN NO_DATA_FOUND THEN
                K_PTOSELIMXBAJA:=0;
           END;
       --DTH
       ELSIF K_TIPOBOLSA='6' THEN
           BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO V_PTOBAJASALIDA
               FROM PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEFIJA C, PCLUB.ADMPT_CLIENTEPRODUCTO P
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               --AND C.ADMPC_ESTADO='A'
               AND  C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
               AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPV_COD_CPTO IN ('57','68','72');

               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO V_PTOBAJAENTRADA FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               AND  C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPV_COD_CPTO IN (57);

               K_PTOSELIMXBAJA:=V_PTOBAJASALIDA - V_PTOBAJAENTRADA;

            EXCEPTION
            WHEN NO_DATA_FOUND THEN
               K_PTOSELIMXBAJA:=0;
            END;
       --HFC
       ELSIF K_TIPOBOLSA='7' THEN
           BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO V_PTOBAJASALIDA FROM PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEFIJA C, PCLUB.ADMPT_CLIENTEPRODUCTO P
               WHERE C.ADMPV_TIPO_DOC=K_TIPODOC
               AND   C.ADMPV_NUM_DOC=K_NRODOC
               AND   C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               --AND   C.ADMPC_ESTADO='A'
               AND   C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
               AND   P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
               AND   K.ADMPC_TPO_OPER = 'S'
               AND   K.ADMPV_COD_CPTO IN ('58','69','73');

               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO V_PTOBAJAENTRADA FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               AND  C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPV_COD_CPTO IN (58);

               K_PTOSELIMXBAJA:=V_PTOBAJASALIDA - V_PTOBAJAENTRADA;

            EXCEPTION
               WHEN NO_DATA_FOUND THEN
               K_PTOSELIMXBAJA:=0;
            END;
       --TFI
       ELSIF K_TIPOBOLSA='8' THEN
           BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO V_PTOBAJASALIDA FROM  --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K,  PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               AND  C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPV_COD_CPTO IN (86,89,92);


               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO V_PTOBAJAENTRADA FROM  --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K,  PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               AND  C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPV_COD_CPTO IN (93);

               K_PTOSELIMXBAJA:=V_PTOBAJASALIDA - V_PTOBAJAENTRADA;
           EXCEPTION
           WHEN NO_DATA_FOUND THEN
                K_PTOSELIMXBAJA:=0;
           END;
       ELSE
            K_PTOSELIMXBAJA:=0;
       END IF;

   K_CODERROR  := 0;

   EXCEPTION
        WHEN OTHERS THEN
          K_CODERROR  := 1;
          K_DESCERROR := 'NO OK';
          K_PTOSELIMXBAJA:=0;
   END ADMPSI_PTOSELIMXBAJA;

  --****************************************************************
  -- Nombre SP           :  ADMPSI_PTOSELIMXVIGEN
  -- Propósito           :  permite listar el Total de los puntos Eliminados x Vigencia
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  --                        K_TIPOBOLSA
  -- Output              :  K_PTOSELIMXVIGEN
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
  --****************************************************************



PROCEDURE ADMPSI_PTOSELIMXVIGEN  (K_TIPODOC IN VARCHAR2,
                                  K_NRODOC IN VARCHAR2,
                                  K_TIPOBOLSA  IN NUMBER,
                                  K_PTOSELIMXVIGEN OUT NUMBER,
                                  K_CODERROR  OUT NUMBER,
                                  K_DESCERROR OUT VARCHAR2)

   IS
   BEGIN

       IF K_TIPOBOLSA='2' THEN
          BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSELIMXVIGEN FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL IN (1,2)
               AND C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPV_COD_CPTO = 16;
           EXCEPTION
           WHEN NO_DATA_FOUND THEN
           K_PTOSELIMXVIGEN:=0;
           END;

       ELSIF K_TIPOBOLSA='3' THEN
           BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSELIMXVIGEN FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               AND  C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND  C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPV_COD_CPTO IN (33,16,103,105,106,107,108,109,110);
            EXCEPTION
               WHEN NO_DATA_FOUND THEN
               K_PTOSELIMXVIGEN:=0;
            END;
       --DTH
       ELSIF K_TIPOBOLSA='6' THEN
           BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSELIMXVIGEN FROM PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEFIJA C, PCLUB.ADMPT_CLIENTEPRODUCTO P
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               --AND C.ADMPC_ESTADO='A'
               AND C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
               AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPV_COD_CPTO IN (62);
            EXCEPTION
               WHEN NO_DATA_FOUND THEN
               K_PTOSELIMXVIGEN:=0;
            END;
       --HFC
       ELSIF K_TIPOBOLSA='7' THEN
           BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSELIMXVIGEN FROM PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEFIJA C, PCLUB.ADMPT_CLIENTEPRODUCTO P
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               --AND C.ADMPC_ESTADO='A'
               AND C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
               AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPV_COD_CPTO IN (63);
            EXCEPTION
               WHEN NO_DATA_FOUND THEN
               K_PTOSELIMXVIGEN:=0;
            END;
       --TFI
       ELSIF K_TIPOBOLSA='8' THEN
           BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSELIMXVIGEN FROM  --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K,  PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               AND  C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND  C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPV_COD_CPTO IN (87);
            EXCEPTION
               WHEN NO_DATA_FOUND THEN
               K_PTOSELIMXVIGEN:=0;
            END;
       ELSE
            K_PTOSELIMXVIGEN:=0;
       END IF;
   K_CODERROR  := 0;
   EXCEPTION
        WHEN OTHERS THEN
          K_CODERROR  := 1;
          K_DESCERROR := 'NO OK';
          K_PTOSELIMXVIGEN:=0;
   END ADMPSI_PTOSELIMXVIGEN;


  --****************************************************************
  -- Nombre SP           :  ADMPSI_PTOSTRANSFERENCIA_BC
  -- Propósito           :  permite listar el Total de los puntos Transferidos de Bonus a Claro
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  --                        K_TIPOBOLSA
  -- Output              :  K_PTOSTRANSFERENCIA_BC
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
  --****************************************************************


PROCEDURE ADMPSI_PTOSTRANSFERENCIA_BC( K_TIPODOC IN VARCHAR2,
                                        K_NRODOC IN VARCHAR2,
                                        K_TIPOBOLSA  IN NUMBER,
                                        K_PTOSTRANSFERENCIA_BC OUT NUMBER,
                                        K_CODERROR  OUT NUMBER,
                                        K_DESCERROR OUT VARCHAR2)
   IS
   BEGIN

       IF K_TIPOBOLSA='2' THEN
          BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSTRANSFERENCIA_BC FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL IN (1,2)
               AND C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPV_COD_CPTO=24;
           EXCEPTION
           WHEN NO_DATA_FOUND THEN
           K_PTOSTRANSFERENCIA_BC:=0;
           END;
       ELSE
           K_PTOSTRANSFERENCIA_BC:=0;
       END IF;

   K_CODERROR  := 0;

   EXCEPTION
        WHEN OTHERS THEN
          K_CODERROR  := 1;
          K_DESCERROR := 'NO OK';
          K_PTOSTRANSFERENCIA_BC:=0;
  END ADMPSI_PTOSTRANSFERENCIA_BC;

  --****************************************************************
  -- Nombre SP           :  ADMPSI_PTOSTRANSFERENCIA_CB
  -- Propósito           :  permite listar el Total de los puntos Transferidos de Claro a Bonus
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  --                        K_TIPOBOLSA
  -- Output              :  K_PTOSTRANSFERENCIA_CB
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
  --****************************************************************


  PROCEDURE ADMPSI_PTOSTRANSFERENCIA_CB(K_TIPODOC IN VARCHAR2,
                                        K_NRODOC IN VARCHAR2,
                                        K_TIPOBOLSA  IN NUMBER,
                                        K_PTOSTRANSFERENCIA_CB OUT NUMBER,
                                        K_CODERROR  OUT NUMBER,
                                        K_DESCERROR OUT VARCHAR2)
   IS
   BEGIN

       IF K_TIPOBOLSA='2' THEN
          BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSTRANSFERENCIA_CB FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL IN (1,2)
               AND C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPV_COD_CPTO=25;
           EXCEPTION
           WHEN NO_DATA_FOUND THEN
           K_PTOSTRANSFERENCIA_CB:=0;
           END;
       ELSE
           K_PTOSTRANSFERENCIA_CB:=0;
       END IF;

   K_CODERROR  := 0;

   EXCEPTION
        WHEN OTHERS THEN
          K_CODERROR  := 1;
          K_DESCERROR := 'NO OK';
          K_PTOSTRANSFERENCIA_CB:=0;
  END ADMPSI_PTOSTRANSFERENCIA_CB;

  --****************************************************************
  -- Nombre SP           :  ADMPSI_PTOSMIGPREPAPOST
  -- Propósito           :  permite listar el Total de los puntos Migrados de Prepago a Postpago
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  --                        K_TIPOBOLSA
  -- Output              :  K_PTOSMIGPREPAPOST
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
  --****************************************************************


  PROCEDURE ADMPSI_PTOSMIGPREPAPOST ( K_TIPODOC IN VARCHAR2,
                                      K_NRODOC IN VARCHAR2,
                                      K_TIPOBOLSA  IN NUMBER,
                                      K_PTOSMIGPREPAPOST OUT NUMBER,
                                      K_CODERROR  OUT NUMBER,
                                      K_DESCERROR OUT VARCHAR2)

   IS
   BEGIN

       IF K_TIPOBOLSA='2' THEN
          BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSMIGPREPAPOST FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL IN (1,2)
               AND C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPV_COD_CPTO = '34';
           EXCEPTION
           WHEN NO_DATA_FOUND THEN
                K_PTOSMIGPREPAPOST:=0;
           END;

       ELSIF K_TIPOBOLSA='3' THEN
               BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSMIGPREPAPOST FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               AND  C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND  C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPV_COD_CPTO = '34';
               EXCEPTION
               WHEN NO_DATA_FOUND THEN
                    K_PTOSMIGPREPAPOST:=0;
               END;
       ELSE
               K_PTOSMIGPREPAPOST:=0;
       END IF;
   K_CODERROR  := 0;

   EXCEPTION
        WHEN OTHERS THEN
          K_CODERROR  := 1;
          K_DESCERROR := 'NO OK';
          K_PTOSMIGPREPAPOST:=0;
   END ADMPSI_PTOSMIGPREPAPOST;

  --****************************************************************
  -- Nombre SP           :  ADMPSI_PTOSBONMIGR
  -- Propósito           :  permite listar el Total de los puntos Otorgados como Bono de Migracion
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  --                        K_TIPOBOLSA
  -- Output              :  K_PTOSBONMIGR
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
  --****************************************************************


   PROCEDURE ADMPSI_PTOSBONMIGR ( K_TIPODOC IN VARCHAR2,
                                  K_NRODOC IN VARCHAR2,
                                  K_TIPOBOLSA  IN NUMBER,
                                  K_PTOSBONMIGR OUT NUMBER,
                                  K_CODERROR  OUT NUMBER,
                                  K_DESCERROR OUT VARCHAR2)

   IS
   BEGIN

       IF K_TIPOBOLSA='2' THEN
          BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSBONMIGR FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL IN (1,2)
               AND C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPV_COD_CPTO = '36'
               AND C.ADMPC_ESTADO='A';
           EXCEPTION
           WHEN NO_DATA_FOUND THEN
           K_PTOSBONMIGR:=0;
           END;
       ELSE
           K_PTOSBONMIGR:=0;
       END IF;
   K_CODERROR  := 0;
   EXCEPTION
        WHEN OTHERS THEN
          K_CODERROR  := 1;
          K_DESCERROR := 'NO OK';
          K_PTOSBONMIGR:=0;
   END ADMPSI_PTOSBONMIGR;

  --****************************************************************
  -- Nombre SP           :  ADMPSI_PTOSTRANSAPOS
  -- Propósito           :  permite listar el Total de los puntos Transferidos a Postpago
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  --                        K_TIPOBOLSA
  -- Output              :  K_PTOSTRANSAPOS
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
  --****************************************************************

   PROCEDURE ADMPSI_PTOSTRANSAPOS(K_TIPODOC       IN VARCHAR2,
                                  K_NRODOC        IN VARCHAR2,
                                  K_TIPOBOLSA     IN NUMBER,
                                  K_PTOSTRANSAPOS OUT NUMBER,
                                  K_CODERROR      OUT NUMBER,
                                  K_DESCERROR     OUT VARCHAR2)

    IS
   BEGIN

     IF K_TIPOBOLSA = '2' THEN
       BEGIN
         SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS), 0)),-1,NVL(SUM(K.ADMPN_PUNTOS), 0) * -1,NVL(SUM(K.ADMPN_PUNTOS), 0))
           INTO K_PTOSTRANSAPOS
           FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
          WHERE C.ADMPV_TIPO_DOC = K_TIPODOC
            AND C.ADMPV_NUM_DOC = K_NRODOC
            AND C.ADMPV_COD_TPOCL IN (1,2)
            AND C.ADMPV_COD_CLI = K.ADMPV_COD_CLI
            --AND C.ADMPC_ESTADO='A'
            AND K.ADMPC_TPO_OPER = 'E'
            AND K.ADMPV_COD_CPTO = '46';
       EXCEPTION
         WHEN NO_DATA_FOUND THEN
           K_PTOSTRANSAPOS := 0;
       END;
     ELSIF K_TIPOBOLSA = '3' THEN
       BEGIN
         SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS), 0)),-1,NVL(SUM(K.ADMPN_PUNTOS), 0) * -1,NVL(SUM(K.ADMPN_PUNTOS), 0))
           INTO K_PTOSTRANSAPOS
           FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
          WHERE C.ADMPV_TIPO_DOC = K_TIPODOC
            AND C.ADMPV_NUM_DOC = K_NRODOC
            AND C.ADMPV_COD_TPOCL = K_TIPOBOLSA
            AND C.ADMPV_COD_CLI = K.ADMPV_COD_CLI
            --AND C.ADMPC_ESTADO='A'
            AND K.ADMPC_TPO_OPER = 'E'
            AND K.ADMPV_COD_CPTO = '46';
       EXCEPTION
         WHEN NO_DATA_FOUND THEN
           K_PTOSTRANSAPOS := 0;
       END;
     ELSE
     K_PTOSTRANSAPOS := 0;
     END IF;

     K_CODERROR := 0;
   EXCEPTION
     WHEN OTHERS THEN
       K_CODERROR      := 1;
       K_DESCERROR     := 'NO OK';
       K_PTOSTRANSAPOS := 0;
   END ADMPSI_PTOSTRANSAPOS;

  --****************************************************************
  -- Nombre SP           :  ADMPSI_PTOSMIGPOSTAPREP
  -- Propósito           :  permite listar el Total de los puntos Migrados de Postpago a Prepago
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  --                        K_TIPOBOLSA
  -- Output              :  K_PTOSMIGPOSTAPREP
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
  --****************************************************************


   PROCEDURE ADMPSI_PTOSMIGPOSTAPREP ( K_TIPODOC IN VARCHAR2,
                                      K_NRODOC IN VARCHAR2,
                                      K_TIPOBOLSA  IN NUMBER,
                                      K_PTOSMIGPOSTAPREP OUT NUMBER,
                                      K_CODERROR  OUT NUMBER,
                                      K_DESCERROR OUT VARCHAR2)

   IS
   V_PTOMIGSALIDA NUMBER;
   V_PTOBMIGENTRADA NUMBER;
   BEGIN

       IF K_TIPOBOLSA='2' THEN
          BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO V_PTOMIGSALIDA FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL IN (1,2)
               AND C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
              --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPV_COD_CPTO = '35';

               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO V_PTOBMIGENTRADA FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL IN (1,2)
               AND C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPV_COD_CPTO = '35';

               K_PTOSMIGPOSTAPREP:= V_PTOMIGSALIDA - V_PTOBMIGENTRADA;

           EXCEPTION
           WHEN NO_DATA_FOUND THEN
           K_PTOSMIGPOSTAPREP:=0;
           END;

       ELSIF K_TIPOBOLSA='3' THEN
               BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSMIGPOSTAPREP FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               AND  C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPV_COD_CPTO = '35';
               EXCEPTION
               WHEN NO_DATA_FOUND THEN
               K_PTOSMIGPOSTAPREP:=0;
               END;
       ELSE
               K_PTOSMIGPOSTAPREP:=0;
       END IF;
   K_CODERROR  := 0;

   EXCEPTION
        WHEN OTHERS THEN
          K_CODERROR  := 1;
          K_DESCERROR := 'NO OK';
          K_PTOSMIGPOSTAPREP:=0;
   END ADMPSI_PTOSMIGPOSTAPREP;

  --****************************************************************
  -- Nombre SP           :  ADMPSI_PTOSRENOV
  -- Propósito           :  permite listar el Total de los puntos por Renovacion
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  --                        K_TIPOBOLSA
  -- Output              :  K_PTOSRENOV
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
  --****************************************************************


PROCEDURE ADMPSI_PTOSRENOV( K_TIPODOC IN VARCHAR2,
                            K_NRODOC IN VARCHAR2,
                            K_TIPOBOLSA  IN NUMBER,
                            K_PTOSRENOV OUT NUMBER,
                            K_CODERROR  OUT NUMBER,
                            K_DESCERROR OUT VARCHAR2)

   IS
   BEGIN
          BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSRENOV FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL IN (1,2)
               AND C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPV_COD_CPTO = '22';
           EXCEPTION
           WHEN NO_DATA_FOUND THEN
           K_PTOSRENOV:=0;
           END;
   K_CODERROR  := 0;
   EXCEPTION
        WHEN OTHERS THEN
          K_CODERROR  := 1;
          K_DESCERROR := 'NO OK';
          K_PTOSRENOV:=0;
   END ADMPSI_PTOSRENOV;

  --****************************************************************
  -- Nombre SP           :  ADMPSI_PTOSPENMIGRAPREP
  -- Propósito           :  permite listar el Total de los puntos Pendientes de Migracion a Prepago
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  --                        K_TIPOBOLSA
  -- Output              :  K_PTOSPENMIGRAPREP
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
  --****************************************************************

PROCEDURE ADMPSI_PTOSPENMIGRAPREP ( K_TIPODOC IN VARCHAR2,
                                    K_NRODOC IN VARCHAR2,
                                    K_TIPOBOLSA  IN NUMBER,
                                    K_PTOSPENMIGRAPREP OUT NUMBER,
                                    K_CODERROR  OUT NUMBER,
                                    K_DESCERROR OUT VARCHAR2)

   IS
   BEGIN
          BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSPENMIGRAPREP FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTE C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND C.ADMPV_NUM_DOC=K_NRODOC
               AND C.ADMPV_COD_TPOCL=K_TIPOBOLSA
               AND C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPV_COD_CPTO = '37';
           EXCEPTION
           WHEN NO_DATA_FOUND THEN
           K_PTOSPENMIGRAPREP:=0;
           END;
   K_CODERROR  := 0;
   EXCEPTION
        WHEN OTHERS THEN
          K_CODERROR  := 1;
          K_DESCERROR := 'NO OK';
          K_PTOSPENMIGRAPREP:=0;
   END ADMPSI_PTOSPENMIGRAPREP;

  --****************************************************************
  -- Nombre SP           :  ADMPSI_PTOSACUMIB
  -- Propósito           :  permite listar el Total de los puntos Acumulados IB
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  -- Output              :  K_PTOSACUMIB
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
  --****************************************************************

PROCEDURE ADMPSI_PTOSACUMIB(K_TIPODOC IN VARCHAR2,
                            K_NRODOC IN VARCHAR2,
                            K_PTOSACUMIB OUT NUMBER,
                            K_CODERROR  OUT NUMBER,
                            K_DESCERROR OUT VARCHAR2)

   IS
   BEGIN
           BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSACUMIB FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTEIB C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'E'
               AND  K.ADMPC_TPO_PUNTO='I'
               AND  K.ADMPV_COD_CPTO IN (1,4);
            EXCEPTION
               WHEN NO_DATA_FOUND THEN
               K_PTOSACUMIB:=0;
            END;
   K_CODERROR  := 0;

   EXCEPTION
        WHEN OTHERS THEN
          K_CODERROR  := 1;
          K_DESCERROR := 'NO OK';
          K_PTOSACUMIB:=0;
   END ADMPSI_PTOSACUMIB;

  --****************************************************************
  -- Nombre SP           :  ADMPSI_PTOSELIMIBXBAJA
  -- Propósito           :  permite listar el Total de los puntos Eliminados por Baja de un ClienteIB
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  -- Output              :  K_PTOSELIMIBXBAJA
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
  --****************************************************************

   PROCEDURE ADMPSI_PTOSELIMIBXBAJA (K_TIPODOC IN VARCHAR2,
                                  K_NRODOC IN VARCHAR2,
                                  K_PTOSELIMIBXBAJA OUT NUMBER,
                                  K_CODERROR  OUT NUMBER,
                                  K_DESCERROR OUT VARCHAR2)

   IS
   BEGIN
           BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSELIMIBXBAJA FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTEIB C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
               --AND  C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPC_TPO_PUNTO='I'
               AND  K.ADMPV_COD_CPTO=2;
            EXCEPTION
               WHEN NO_DATA_FOUND THEN
               K_PTOSELIMIBXBAJA:=0;
            END;
   K_CODERROR  := 0;

   EXCEPTION
        WHEN OTHERS THEN
          K_CODERROR  := 1;
          K_DESCERROR := 'NO OK';
          K_PTOSELIMIBXBAJA:=0;
   END ADMPSI_PTOSELIMIBXBAJA;

  --****************************************************************
  -- Nombre SP           :  ADMPSI_PTOSIBELIMXVIG
  -- Propósito           :  permite listar el Total de los puntos Eliminados por Vigencia de un ClienteIB
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  -- Output              :  K_PTOSIBELIMXVIG
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
  --****************************************************************


   PROCEDURE ADMPSI_PTOSIBELIMXVIG (K_TIPODOC IN VARCHAR2,
                                  K_NRODOC IN VARCHAR2,
                                  K_PTOSIBELIMXVIG OUT NUMBER,
                                  K_CODERROR  OUT NUMBER,
                                  K_DESCERROR OUT VARCHAR2)

   IS
   BEGIN
           BEGIN
               SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS),0)),-1, NVL(SUM(K.ADMPN_PUNTOS),0)*-1,NVL(SUM(K.ADMPN_PUNTOS),0))
               INTO K_PTOSIBELIMXVIG FROM --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K, PCLUB.ADMPT_CLIENTEIB C
               WHERE  C.ADMPV_TIPO_DOC=K_TIPODOC
               AND  C.ADMPV_NUM_DOC=K_NRODOC
               AND  C.ADMPV_COD_CLI=K.ADMPV_COD_CLI
              --AND C.ADMPC_ESTADO='A'
               AND  K.ADMPC_TPO_OPER = 'S'
               AND  K.ADMPC_TPO_PUNTO='I'
               AND  K.ADMPV_COD_CPTO='16';
            EXCEPTION
               WHEN NO_DATA_FOUND THEN
               K_PTOSIBELIMXVIG:=0;
            END;
   K_CODERROR  := 0;

   EXCEPTION
        WHEN OTHERS THEN
          K_CODERROR  := 1;
          K_DESCERROR := 'NO OK';
          K_PTOSIBELIMXVIG:=0;
   END ADMPSI_PTOSIBELIMXVIG;


  --****************************************************************
  -- Nombre SP           :  ADMPSI_CONCANJES
  -- Propósito           :  permite listar el detalle de los Canjes
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  --                        K_TIPOBOLSA
  -- Output              :  K_CUR_LISTA
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
  --****************************************************************


PROCEDURE ADMPSI_CONCANJES(K_TIPODOC   IN VARCHAR2,
                           K_NRODOC    IN VARCHAR2,
                           K_TIPOBOLSA IN NUMBER,
                           K_CUR_LISTA OUT SYS_REFCURSOR,
                           K_CODERROR  OUT NUMBER,
                           K_DESCERROR OUT VARCHAR2)

IS
BEGIN


  IF K_TIPOBOLSA = 2 THEN
    OPEN K_CUR_LISTA FOR
      SELECT CD.ADMPV_DESC     AS PREMIO,
             C.ADMPD_FEC_CANJE AS FECHA,
             CD.ADMPN_PUNTOS   AS PUNTOS,
             CD.ADMPN_CANTIDAD AS CANTIDAD
        FROM PCLUB.ADMPT_CANJE C, PCLUB.ADMPT_CANJE_DETALLE CD
       WHERE C.ADMPV_ID_CANJE = CD.ADMPV_ID_CANJE
         AND C.ADMPV_COD_CLI IN
             (SELECT X.ADMPV_COD_CLI
                FROM PCLUB.ADMPT_CLIENTE X
               WHERE X.ADMPV_TIPO_DOC = K_TIPODOC
                 AND X.ADMPV_NUM_DOC = K_NRODOC
                 AND X.ADMPV_COD_TPOCL IN (1,2)
                 /*AND X.ADMPC_ESTADO = 'A'*/)
         AND C.ADMPC_TPO_OPER = 'C'
       ORDER BY FECHA DESC;
  ELSIF K_TIPOBOLSA = 3 THEN
      OPEN K_CUR_LISTA FOR
      SELECT CD.ADMPV_DESC     AS PREMIO,
             C.ADMPD_FEC_CANJE AS FECHA,
             CD.ADMPN_PUNTOS   AS PUNTOS,
             CD.ADMPN_CANTIDAD AS CANTIDAD
        FROM PCLUB.ADMPT_CANJE C, PCLUB.ADMPT_CANJE_DETALLE CD
       WHERE C.ADMPV_ID_CANJE = CD.ADMPV_ID_CANJE
         AND C.ADMPV_COD_CLI IN
             (SELECT X.ADMPV_COD_CLI
                FROM PCLUB.ADMPT_CLIENTE X
               WHERE X.ADMPV_TIPO_DOC = K_TIPODOC
                 AND X.ADMPV_NUM_DOC = K_NRODOC
                 AND X.ADMPV_COD_TPOCL = K_TIPOBOLSA
                 /*AND X.ADMPC_ESTADO = 'A'*/)
         AND C.ADMPC_TPO_OPER = 'C'
       ORDER BY FECHA DESC;
  ELSIF K_TIPOBOLSA = 6 THEN
      OPEN K_CUR_LISTA FOR
      SELECT CD.ADMPV_DESC     AS PREMIO,
             C.ADMPD_FEC_CANJE AS FECHA,
             CD.ADMPN_PUNTOS   AS PUNTOS,
             CD.ADMPN_CANTIDAD AS CANTIDAD
        FROM PCLUB.ADMPT_CANJEFIJA C, PCLUB.ADMPT_CANJE_DETALLEFIJA CD
       WHERE C.ADMPV_ID_CANJE = CD.ADMPV_ID_CANJE
         AND C.ADMPV_COD_CLI IN
             (SELECT X.ADMPV_COD_CLI
                FROM PCLUB.ADMPT_CLIENTEFIJA X
               WHERE X.ADMPV_TIPO_DOC = K_TIPODOC
                 AND X.ADMPV_NUM_DOC = K_NRODOC
                 AND X.ADMPV_COD_TPOCL = K_TIPOBOLSA
                 /*AND X.ADMPC_ESTADO = 'A'*/)
         AND C.ADMPC_TPO_OPER = 'C'
       ORDER BY FECHA DESC;
  ELSIF K_TIPOBOLSA = 7 THEN
      OPEN K_CUR_LISTA FOR
      SELECT CD.ADMPV_DESC     AS PREMIO,
             C.ADMPD_FEC_CANJE AS FECHA,
             CD.ADMPN_PUNTOS   AS PUNTOS,
             CD.ADMPN_CANTIDAD AS CANTIDAD
        FROM PCLUB.ADMPT_CANJEFIJA C, PCLUB.ADMPT_CANJE_DETALLEFIJA CD
       WHERE C.ADMPV_ID_CANJE = CD.ADMPV_ID_CANJE
         AND C.ADMPV_COD_CLI IN
             (SELECT X.ADMPV_COD_CLI
                FROM PCLUB.ADMPT_CLIENTEFIJA X
               WHERE X.ADMPV_TIPO_DOC = K_TIPODOC
                 AND X.ADMPV_NUM_DOC = K_NRODOC
                 AND X.ADMPV_COD_TPOCL = K_TIPOBOLSA
                 AND X.ADMPC_ESTADO = 'A')
         AND C.ADMPC_TPO_OPER = 'C'
       ORDER BY FECHA DESC;
  --TFI
  ELSIF K_TIPOBOLSA = 8 THEN
      OPEN K_CUR_LISTA FOR
      SELECT CD.ADMPV_DESC     AS PREMIO,
             C.ADMPD_FEC_CANJE AS FECHA,
             CD.ADMPN_PUNTOS   AS PUNTOS,
             CD.ADMPN_CANTIDAD AS CANTIDAD
        FROM  PCLUB.ADMPT_CANJE C,  PCLUB.ADMPT_CANJE_DETALLE CD
       WHERE C.ADMPV_ID_CANJE = CD.ADMPV_ID_CANJE
         AND C.ADMPV_COD_CLI IN
             (SELECT X.ADMPV_COD_CLI
                FROM  PCLUB.ADMPT_CLIENTE X
               WHERE X.ADMPV_TIPO_DOC = K_TIPODOC
                 AND X.ADMPV_NUM_DOC = K_NRODOC
                 AND X.ADMPV_COD_TPOCL = K_TIPOBOLSA
                 AND X.ADMPC_ESTADO = 'A')
         AND C.ADMPC_TPO_OPER = 'C'
       ORDER BY FECHA DESC;
  END IF;

  K_CODERROR := 0;
EXCEPTION
  WHEN OTHERS THEN
    K_CODERROR  := 1;
    K_DESCERROR := 'NO OK';
END ADMPSI_CONCANJES;

  --****************************************************************
  -- Nombre SP           :  ADMPSI_CONDEVOL
  -- Propósito           :  permite listar el detalle de las devoluciones
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  --                        K_TIPOBOLSA
  -- Output              :  K_CUR_LISTA
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
  --****************************************************************

  PROCEDURE ADMPSI_CONDEVOL(  K_TIPODOC IN VARCHAR2,
                              K_NRODOC IN VARCHAR2,
                              K_TIPOBOLSA  IN NUMBER,
                              K_CUR_LISTA OUT SYS_REFCURSOR,
                              K_CODERROR  OUT NUMBER,
                              K_DESCERROR OUT VARCHAR2)

   IS
   BEGIN

       IF K_TIPOBOLSA = 2 THEN
       OPEN K_CUR_LISTA FOR
        SELECT CD.ADMPV_DESC      AS PREMIODEVUELTO,
               CD.ADMPD_FEC_REG   AS FECDEVOLUCION
          FROM PCLUB.ADMPT_CANJE C, PCLUB.ADMPT_CANJE_DETALLE CD
        WHERE C.ADMPV_ID_CANJE = CD.ADMPV_ID_CANJE
           AND C.ADMPV_COD_CLI IN
               (SELECT X.ADMPV_COD_CLI
                  FROM PCLUB.ADMPT_CLIENTE X
                 WHERE X.ADMPV_TIPO_DOC = K_TIPODOC
                   AND X.ADMPV_NUM_DOC = K_NRODOC
                   AND X.ADMPV_COD_TPOCL IN (1,2)
                   /*AND X.ADMPC_ESTADO = 'A'*/)
           AND C.ADMPC_TPO_OPER = 'D'
         ORDER BY FECDEVOLUCION DESC;
       ELSIF K_TIPOBOLSA = 3 THEN
       OPEN K_CUR_LISTA FOR
        SELECT CD.ADMPV_DESC      AS PREMIODEVUELTO,
               CD.ADMPD_FEC_REG   AS FECDEVOLUCION
          FROM PCLUB.ADMPT_CANJE C, PCLUB.ADMPT_CANJE_DETALLE CD
         WHERE C.ADMPV_ID_CANJE = CD.ADMPV_ID_CANJE
           AND C.ADMPV_COD_CLI IN
               (SELECT X.ADMPV_COD_CLI
                  FROM PCLUB.ADMPT_CLIENTE X
                 WHERE X.ADMPV_TIPO_DOC = K_TIPODOC
                   AND X.ADMPV_NUM_DOC = K_NRODOC
                   AND X.ADMPV_COD_TPOCL = K_TIPOBOLSA
                   /*AND X.ADMPC_ESTADO = 'A'*/)
           AND C.ADMPC_TPO_OPER = 'D'
         ORDER BY FECDEVOLUCION DESC;
       END IF;

   K_CODERROR  := 0;
   EXCEPTION
        WHEN OTHERS THEN
          K_CODERROR  := 1;
          K_DESCERROR := 'NO OK';
   END ADMPSI_CONDEVOL;


--****************************************************************
  -- Nombre SP           :  ADMPSI_PTOSPORVENCER2M
  -- Propósito           :  permite listar el total de los puntos por vencer en los dos siguientes meses
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  --                        K_TIPOBOLSA
  -- Output              :  K_PTOSPORVENCER2M
  --                        K_PTOS1M
  --                        K_PTOS2M
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
--****************************************************************


  PROCEDURE ADMPSI_PTOSPORVENCER2M(K_TIPODOC         IN VARCHAR2,
                                   K_NRODOC          IN VARCHAR2,
                                   K_TIPOBOLSA       IN NUMBER,
                                   K_PTOSPORVENCER2M OUT NUMBER,
                                   K_PTOS1M          OUT NUMBER,
                                   K_PTOS2M          OUT NUMBER,
                                   K_CODERROR        OUT NUMBER,
                                   K_DESCERROR       OUT VARCHAR2)

   IS
    P_MES VARCHAR(20);
  BEGIN
    P_MES := TO_CHAR(SYSDATE, 'YYYYMM');

    IF K_TIPOBOLSA = '2' THEN
      BEGIN
        SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_SLD_PUNTO), 0)),
                      -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0) * -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0))
          INTO K_PTOSPORVENCER2M
          FROM PCLUB.ADMPT_CLIENTE C, --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K
         WHERE C.ADMPV_TIPO_DOC = K_TIPODOC
           AND C.ADMPV_NUM_DOC = K_NRODOC
           AND C.ADMPV_COD_TPOCL IN (1, 2)
           AND C.ADMPV_COD_CLI = K.ADMPV_COD_CLI
           --AND C.ADMPC_ESTADO='A'
           AND K.ADMPC_TPO_OPER = 'E'
           AND K.ADMPN_SLD_PUNTO > 0
           AND K.ADMPC_TPO_PUNTO IN ('I', 'L', 'C')
           AND K.ADMPD_FEC_TRANS >=
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -17)
           AND K.ADMPD_FEC_TRANS <
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -15);
      EXCEPTION
        WHEN NO_DATA_FOUND THEN
          K_PTOSPORVENCER2M := 0;
      END;

      --1ER MES
      BEGIN
        SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_SLD_PUNTO), 0)),
                      -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0) * -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0))
          INTO K_PTOS1M
          FROM PCLUB.ADMPT_CLIENTE C, --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K
         WHERE C.ADMPV_TIPO_DOC = K_TIPODOC
           AND C.ADMPV_NUM_DOC = K_NRODOC
           AND C.ADMPV_COD_TPOCL IN (1, 2)
           AND C.ADMPV_COD_CLI = K.ADMPV_COD_CLI
           --AND C.ADMPC_ESTADO='A'
           AND K.ADMPC_TPO_OPER = 'E'
           AND K.ADMPN_SLD_PUNTO > 0
           AND K.ADMPC_TPO_PUNTO IN ('I', 'L', 'C')
           AND K.ADMPD_FEC_TRANS >=
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -17)
           AND K.ADMPD_FEC_TRANS <
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -16);
      EXCEPTION
        WHEN NO_DATA_FOUND THEN
          K_PTOS1M := 0;
      END;

      --2DO MES
      BEGIN
        SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_SLD_PUNTO), 0)),
                      -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0) * -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0))
          INTO K_PTOS2M
          FROM PCLUB.ADMPT_CLIENTE C, --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K
         WHERE C.ADMPV_TIPO_DOC = K_TIPODOC
           AND C.ADMPV_NUM_DOC = K_NRODOC
           AND C.ADMPV_COD_TPOCL IN (1, 2)
           AND C.ADMPV_COD_CLI = K.ADMPV_COD_CLI
           --AND C.ADMPC_ESTADO='A'
           AND K.ADMPC_TPO_OPER = 'E'
           AND K.ADMPN_SLD_PUNTO > 0
           AND K.ADMPC_TPO_PUNTO IN ('I', 'L', 'C')
           AND K.ADMPD_FEC_TRANS >=
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -16)
           AND K.ADMPD_FEC_TRANS <=
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -15);
      EXCEPTION
        WHEN NO_DATA_FOUND THEN
          K_PTOS2M := 0;
      END;
    ELSIF K_TIPOBOLSA = 3 or K_TIPOBOLSA = 8 THEN
      BEGIN
        SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_SLD_PUNTO), 0)),
                     -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0) * -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0))
          INTO K_PTOSPORVENCER2M
          FROM PCLUB.ADMPT_CLIENTE C, --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K
         WHERE C.ADMPV_TIPO_DOC = K_TIPODOC
           AND C.ADMPV_NUM_DOC = K_NRODOC
           AND C.ADMPV_COD_TPOCL = K_TIPOBOLSA
           AND C.ADMPV_COD_CLI = K.ADMPV_COD_CLI
           --AND C.ADMPC_ESTADO='A'
           AND K.ADMPC_TPO_OPER = 'E'
           AND K.ADMPN_SLD_PUNTO > 0
           AND K.ADMPC_TPO_PUNTO IN ('I', 'L', 'C')
           AND K.ADMPD_FEC_TRANS >=
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -17)
           AND K.ADMPD_FEC_TRANS <
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -15);
      EXCEPTION
        WHEN NO_DATA_FOUND THEN
          K_PTOSPORVENCER2M := 0;
      END;

      --1ER MES
      BEGIN
        SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_SLD_PUNTO), 0)),
                      -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0) * -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0))
          INTO K_PTOS1M
          FROM PCLUB.ADMPT_CLIENTE C, --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K
         WHERE C.ADMPV_TIPO_DOC = K_TIPODOC
           AND C.ADMPV_NUM_DOC = K_NRODOC
           AND C.ADMPV_COD_TPOCL = K_TIPOBOLSA
           AND C.ADMPV_COD_CLI = K.ADMPV_COD_CLI
           --AND C.ADMPC_ESTADO='A'
           AND K.ADMPC_TPO_OPER = 'E'
           AND K.ADMPN_SLD_PUNTO > 0
           AND K.ADMPC_TPO_PUNTO IN ('I', 'L', 'C')
           AND K.ADMPD_FEC_TRANS >=
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -17)
           AND K.ADMPD_FEC_TRANS <
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -16);
      EXCEPTION
        WHEN NO_DATA_FOUND THEN
          K_PTOS1M := 0;
      END;

      --2DO MES
      BEGIN
        SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_SLD_PUNTO), 0)),
                      -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0) * -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0))
          INTO K_PTOS2M
          FROM PCLUB.ADMPT_CLIENTE C, --PCLUB.ADMPT_KARDEX K
        PCLUB.VIEW_ADMPT_KARDEX K
         WHERE C.ADMPV_TIPO_DOC = K_TIPODOC
           AND C.ADMPV_NUM_DOC = K_NRODOC
           AND C.ADMPV_COD_TPOCL = K_TIPOBOLSA
           AND C.ADMPV_COD_CLI = K.ADMPV_COD_CLI
           --AND C.ADMPC_ESTADO='A'
           AND K.ADMPC_TPO_OPER = 'E'
           AND K.ADMPN_SLD_PUNTO > 0
           AND K.ADMPC_TPO_PUNTO IN ('I', 'L', 'C')
           AND K.ADMPD_FEC_TRANS >=
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -16)
           AND K.ADMPD_FEC_TRANS <=
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -15);
      EXCEPTION
        WHEN NO_DATA_FOUND THEN
          K_PTOS2M := 0;
      END;

    ELSIF K_TIPOBOLSA = 6 THEN
      BEGIN
        SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_SLD_PUNTO), 0)),
                      -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0) * -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0))
          INTO K_PTOSPORVENCER2M
          FROM PCLUB.ADMPT_CLIENTEFIJA C, PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEPRODUCTO P
         WHERE C.ADMPV_TIPO_DOC = K_TIPODOC
           AND C.ADMPV_NUM_DOC = K_NRODOC
           AND C.ADMPV_COD_TPOCL = K_TIPOBOLSA
           AND C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
           AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
           --AND C.ADMPC_ESTADO='A'
           AND K.ADMPC_TPO_OPER = 'E'
           AND K.ADMPN_SLD_PUNTO > 0
           AND K.ADMPC_TPO_PUNTO IN ('I', 'L', 'C')
           AND K.ADMPD_FEC_TRANS >=
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -17)
           AND K.ADMPD_FEC_TRANS <
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -15);
      EXCEPTION
        WHEN NO_DATA_FOUND THEN
          K_PTOSPORVENCER2M := 0;
      END;

      --1ER MES
      BEGIN
        SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_SLD_PUNTO), 0)),
                      -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0) * -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0))
          INTO K_PTOS1M
          FROM PCLUB.ADMPT_CLIENTEFIJA C, PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEPRODUCTO P
         WHERE C.ADMPV_TIPO_DOC = K_TIPODOC
           AND C.ADMPV_NUM_DOC = K_NRODOC
           AND C.ADMPV_COD_TPOCL = K_TIPOBOLSA
           --AND C.ADMPV_COD_CLI = K.ADMPV_COD_CLI
           AND C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
           AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
           --AND C.ADMPC_ESTADO='A'
           AND K.ADMPC_TPO_OPER = 'E'
           AND K.ADMPN_SLD_PUNTO > 0
           AND K.ADMPC_TPO_PUNTO IN ('I', 'L', 'C')
           AND K.ADMPD_FEC_TRANS >=
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -17)
           AND K.ADMPD_FEC_TRANS <
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -16);
      EXCEPTION
        WHEN NO_DATA_FOUND THEN
          K_PTOS1M := 0;
      END;

      --2DO MES
      BEGIN
        SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_SLD_PUNTO), 0)),
                      -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0) * -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0))
          INTO K_PTOS2M
          FROM PCLUB.ADMPT_CLIENTEFIJA C, PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEPRODUCTO P
         WHERE C.ADMPV_TIPO_DOC = K_TIPODOC
           AND C.ADMPV_NUM_DOC = K_NRODOC
           AND C.ADMPV_COD_TPOCL = K_TIPOBOLSA
           AND C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
           AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
           --AND C.ADMPC_ESTADO='A'
           AND K.ADMPC_TPO_OPER = 'E'
           AND K.ADMPN_SLD_PUNTO > 0
           AND K.ADMPC_TPO_PUNTO IN ('I', 'L', 'C')
           AND K.ADMPD_FEC_TRANS >=
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -16)
           AND K.ADMPD_FEC_TRANS <=
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -15);
      EXCEPTION
        WHEN NO_DATA_FOUND THEN
          K_PTOS2M := 0;
      END;

    ELSIF K_TIPOBOLSA = 7 THEN
      BEGIN
        SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_SLD_PUNTO), 0)),
                      -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0) * -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0))
          INTO K_PTOSPORVENCER2M
          FROM PCLUB.ADMPT_CLIENTEFIJA C, PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEPRODUCTO P
         WHERE C.ADMPV_TIPO_DOC = K_TIPODOC
           AND C.ADMPV_NUM_DOC = K_NRODOC
           AND C.ADMPV_COD_TPOCL = K_TIPOBOLSA
           AND C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
           AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
           --AND C.ADMPC_ESTADO='A'
           AND K.ADMPC_TPO_OPER = 'E'
           AND K.ADMPN_SLD_PUNTO > 0
           AND K.ADMPC_TPO_PUNTO IN ('I', 'L', 'C')
           AND K.ADMPD_FEC_TRANS >=
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -17)
           AND K.ADMPD_FEC_TRANS <
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -15);
      EXCEPTION
        WHEN NO_DATA_FOUND THEN
          K_PTOSPORVENCER2M := 0;
      END;

      --1ER MES
      BEGIN
        SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_SLD_PUNTO), 0)),
                      -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0) * -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0))
          INTO K_PTOS1M
          FROM PCLUB.ADMPT_CLIENTEFIJA C, PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEPRODUCTO P
         WHERE C.ADMPV_TIPO_DOC = K_TIPODOC
           AND C.ADMPV_NUM_DOC = K_NRODOC
           AND C.ADMPV_COD_TPOCL = K_TIPOBOLSA
           AND C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
           AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
           --AND C.ADMPC_ESTADO='A'
           AND K.ADMPC_TPO_OPER = 'E'
           AND K.ADMPN_SLD_PUNTO > 0
           AND K.ADMPC_TPO_PUNTO IN ('I', 'L', 'C')
           AND K.ADMPD_FEC_TRANS >=
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -17)
           AND K.ADMPD_FEC_TRANS <
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -16);
      EXCEPTION
        WHEN NO_DATA_FOUND THEN
          K_PTOS1M := 0;
      END;

      --2DO MES
      BEGIN
        SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_SLD_PUNTO), 0)),
                      -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0) * -1,
                      NVL(SUM(K.ADMPN_SLD_PUNTO), 0))
          INTO K_PTOS2M
          FROM PCLUB.ADMPT_CLIENTEFIJA C, PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEPRODUCTO P
         WHERE C.ADMPV_TIPO_DOC = K_TIPODOC
           AND C.ADMPV_NUM_DOC = K_NRODOC
           AND C.ADMPV_COD_TPOCL = K_TIPOBOLSA
           AND C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
           AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
           --AND C.ADMPC_ESTADO='A'
           AND K.ADMPC_TPO_OPER = 'E'
           AND K.ADMPN_SLD_PUNTO > 0
           AND K.ADMPC_TPO_PUNTO IN ('I', 'L', 'C')
           AND K.ADMPD_FEC_TRANS >=
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -16)
           AND K.ADMPD_FEC_TRANS <=
               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -15);
      EXCEPTION
        WHEN NO_DATA_FOUND THEN
          K_PTOS2M := 0;
      END;

    ELSE
      K_PTOSPORVENCER2M := 0;
      K_PTOS1M          := 0;
      K_PTOS2M          := 0;
    END IF;
    K_CODERROR := 0;

  EXCEPTION
    WHEN OTHERS THEN
      K_CODERROR        := 1;
      K_DESCERROR       := 'NO OK';
      K_PTOSPORVENCER2M := 0;
      K_PTOS1M          := 0;
      K_PTOS2M          := 0;
  END ADMPSI_PTOSPORVENCER2M;

--****************************************************************
-- Nombre SP           :  ADMPSI_DETALLETRANS_CB
-- Propósito           :  permite listar el detalle de los Puntos Transferidos de Claro a Bonus
-- Input               :  K_TIPODOC
--                        K_NRODOC
--                        K_TIPOBOLSA
-- Output              :  CUR_LISTA
--                        K_CODERROR
--                        K_DESCERROR
-- Fec Creación        :  20/07/2012
-- Fec Actualización   :
--****************************************************************

PROCEDURE ADMPSI_DETALLETRANS_CB(K_TIPODOC   IN VARCHAR2,
                                 K_NRODOC    IN VARCHAR2,
                                 K_TIPOBOLSA IN VARCHAR2,
                                 K_CUR_LISTA OUT SYS_REFCURSOR,
                                 K_CODERROR  OUT NUMBER,
                                 K_DESCERROR OUT VARCHAR2)

IS
BEGIN
  --CURSOR CON LA LISTA DE LAS TRANSFERENCIAS A BONUS
  OPEN K_CUR_LISTA FOR

    SELECT T.ADMPD_FECHA     AS FECHA,
           T.ADMPV_PTO_VENTA AS LUGAR,
           T.ADMPN_PUNTOS    AS PUNTOS
      FROM PCLUB.ADMPT_TRANSFERENCIA T
     WHERE T.ADMPV_TIPO_DOC = K_TIPODOC
       AND T.ADMPV_NUM_DOC = K_NRODOC
       AND T.ADMPV_BOLSA IN ('POSTPAGO')
       AND T.ADMPV_TIPO = 'S'
       AND T.ADMPV_ESTADO = 'REALIZADA'
     ORDER BY ADMPN_ID_TRANSCLARO DESC;

  K_CODERROR := 0;
EXCEPTION
  WHEN OTHERS THEN
    K_CODERROR  := 1;
    K_DESCERROR := 'NO OK';

END ADMPSI_DETALLETRANS_CB;

--****************************************************************
-- Nombre SP           :  ADMPSI_DETALLETRANS_BC
-- Propósito           :  permite listar el detalle de los Puntos Transferidos de Bonus a Claro
-- Input               :  K_TIPODOC
--                        K_NRODOC
--                        K_TIPOBOLSA
-- Output              :  CUR_LISTA
--                        K_CODERROR
--                        K_DESCERROR
-- Fec Creación        :  20/07/2012
-- Fec Actualización   :
--****************************************************************

PROCEDURE ADMPSI_DETALLETRANS_BC(K_TIPODOC   IN VARCHAR2,
                                 K_NRODOC    IN VARCHAR2,
                                 K_TIPOBOLSA IN VARCHAR2,
                                 K_CUR_LISTA OUT SYS_REFCURSOR,
                                 K_CODERROR  OUT NUMBER,
                                 K_DESCERROR OUT VARCHAR2)

IS
BEGIN
  --CURSOR CON LA LISTA DE LAS TRANSFERENCIAS DE BONUS
  OPEN K_CUR_LISTA FOR

    SELECT T.ADMPD_FECHA AS FECHA,
           T.ADMPV_PTO_VENTA AS LUGAR,
           T.ADMPN_PUNTOS AS PUNTOS
      FROM PCLUB.ADMPT_TRANSFERENCIA T
     WHERE T.ADMPV_TIPO_DOC = K_TIPODOC
       AND T.ADMPV_NUM_DOC = K_NRODOC
       AND T.ADMPV_BOLSA IN ('POSTPAGO')
       AND T.ADMPV_TIPO = 'I'
       AND T.ADMPV_ESTADO = 'REALIZADA'
     ORDER BY ADMPN_ID_TRANSCLARO DESC;

  K_CODERROR := 0;
EXCEPTION
  WHEN OTHERS THEN
    K_CODERROR  := 1;
    K_DESCERROR := 'NO OK';

END ADMPSI_DETALLETRANS_BC;

  --****************************************************************
  -- Nombre SP           :  ADMPSI_PTOSTRANSFIJA_APOST
  -- Propósito           :  permite listar el Total de los puntos Transferidos de la Fija a Postpago
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  --                        K_TIPOBOLSA
  -- Output              :  K_PTOSTRANSFIJA_APOST
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
  --****************************************************************

   PROCEDURE ADMPSI_PTOSTRANSFIJA_APOST(K_TIPODOC             IN VARCHAR2,
                                        K_NRODOC              IN VARCHAR2,
                                        K_TIPOBOLSA           IN NUMBER,
                                        K_PTOSTRANSFIJA_APOST OUT NUMBER,
                                        K_CODERROR            OUT NUMBER,
                                        K_DESCERROR           OUT VARCHAR2)

    IS
   BEGIN

     --DTH
     IF K_TIPOBOLSA = '6' THEN
       BEGIN
         SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS), 0)),
                       -1,
                       NVL(SUM(K.ADMPN_PUNTOS), 0) * -1,
                       NVL(SUM(K.ADMPN_PUNTOS), 0))
           INTO K_PTOSTRANSFIJA_APOST
           FROM PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEFIJA C, PCLUB.ADMPT_CLIENTEPRODUCTO P
          WHERE C.ADMPV_TIPO_DOC = K_TIPODOC
            AND C.ADMPV_NUM_DOC = K_NRODOC
            AND C.ADMPV_COD_TPOCL =K_TIPOBOLSA
            --AND C.ADMPC_ESTADO='A'
            AND C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
            AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
            AND K.ADMPC_TPO_OPER = 'S'
            AND K.ADMPV_COD_CPTO = '64';
       EXCEPTION
         WHEN NO_DATA_FOUND THEN
           K_PTOSTRANSFIJA_APOST := 0;
       END;
     --HFC
     ELSIF K_TIPOBOLSA = '7' THEN
       BEGIN
         SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS), 0)),
                       -1,
                       NVL(SUM(K.ADMPN_PUNTOS), 0) * -1,
                       NVL(SUM(K.ADMPN_PUNTOS), 0))
           INTO K_PTOSTRANSFIJA_APOST
           FROM PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEFIJA C, PCLUB.ADMPT_CLIENTEPRODUCTO P
          WHERE C.ADMPV_TIPO_DOC = K_TIPODOC
            AND C.ADMPV_NUM_DOC = K_NRODOC
            AND C.ADMPV_COD_TPOCL = K_TIPOBOLSA
            --AND C.ADMPC_ESTADO='A'
            AND C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
            AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
            AND K.ADMPC_TPO_OPER = 'S'
            AND K.ADMPV_COD_CPTO = '66';
       EXCEPTION
         WHEN NO_DATA_FOUND THEN
           K_PTOSTRANSFIJA_APOST := 0;
       END;
     ELSE
       K_PTOSTRANSFIJA_APOST := 0;
     END IF;

     K_CODERROR := 0;
   EXCEPTION
     WHEN OTHERS THEN
       K_CODERROR            := 1;
       K_DESCERROR           := 'NO OK';
       K_PTOSTRANSFIJA_APOST := 0;
   END ADMPSI_PTOSTRANSFIJA_APOST;

  --****************************************************************
  -- Nombre SP           :  ADMPSI_PTOSTRANSFIJA_APRE
  -- Propósito           :  permite listar el Total de los puntos Transferidos de la Fija a Prepago
  -- Input               :  K_TIPODOC
  --                        K_NRODOC
  --                        K_TIPOBOLSA
  -- Output              :  K_PTOSTRANSFIJA_APRE
  --                        K_CODERROR
  --                        K_DESCERROR
  -- Fec Creación        :  20/07/2012
  -- Fec Actualización   :
  --****************************************************************

   PROCEDURE ADMPSI_PTOSTRANSFIJA_APRE(K_TIPODOC            IN VARCHAR2,
                                       K_NRODOC             IN VARCHAR2,
                                       K_TIPOBOLSA          IN NUMBER,
                                       K_PTOSTRANSFIJA_APRE OUT NUMBER,
                                       K_CODERROR           OUT NUMBER,
                                       K_DESCERROR          OUT VARCHAR2)

    IS
   BEGIN

     --DTH
     IF K_TIPOBOLSA = '6' THEN
       BEGIN
         SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS), 0)),
                       -1,
                       NVL(SUM(K.ADMPN_PUNTOS), 0) * -1,
                       NVL(SUM(K.ADMPN_PUNTOS), 0))
           INTO K_PTOSTRANSFIJA_APRE
           FROM PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEFIJA C, PCLUB.ADMPT_CLIENTEPRODUCTO P
          WHERE C.ADMPV_TIPO_DOC = K_TIPODOC
            AND C.ADMPV_NUM_DOC = K_NRODOC
            AND C.ADMPV_COD_TPOCL = K_TIPOBOLSA
            --AND C.ADMPC_ESTADO='A'
            AND C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
            AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
            AND K.ADMPC_TPO_OPER = 'S'
            AND K.ADMPV_COD_CPTO = '65';
       EXCEPTION
         WHEN NO_DATA_FOUND THEN
           K_PTOSTRANSFIJA_APRE := 0;
       END;
     --HFC
     ELSIF K_TIPOBOLSA = '7' THEN
       BEGIN
         SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_PUNTOS), 0)),
                       -1,
                       NVL(SUM(K.ADMPN_PUNTOS), 0) * -1,
                       NVL(SUM(K.ADMPN_PUNTOS), 0))
           INTO K_PTOSTRANSFIJA_APRE
           FROM PCLUB.ADMPT_KARDEXFIJA K, PCLUB.ADMPT_CLIENTEFIJA C , PCLUB.ADMPT_CLIENTEPRODUCTO P
          WHERE C.ADMPV_TIPO_DOC = K_TIPODOC
            AND C.ADMPV_NUM_DOC = K_NRODOC
            AND C.ADMPV_COD_TPOCL = K_TIPOBOLSA
            --AND C.ADMPC_ESTADO='A'
            AND C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
            AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
            AND K.ADMPC_TPO_OPER = 'S'
            AND K.ADMPV_COD_CPTO = '67';
       EXCEPTION
         WHEN NO_DATA_FOUND THEN
           K_PTOSTRANSFIJA_APRE := 0;
       END;
     ELSE
       K_PTOSTRANSFIJA_APRE := 0;
     END IF;

     K_CODERROR := 0;
   EXCEPTION
     WHEN OTHERS THEN
       K_CODERROR           := 1;
       K_DESCERROR          := 'NO OK';
       K_PTOSTRANSFIJA_APRE := 0;
   END ADMPSI_PTOSTRANSFIJA_APRE;
   
   PROCEDURE MICLSS_CLARO_PUNTOS(K_TIPODOC         IN VARCHAR2,
                                   K_NRODOC          IN VARCHAR2,
                                   K_PTOSPORVENCER OUT NUMBER,
                                   K_FECHAVENCIMIENTO OUT DATE,
                                   K_CODERROR        OUT NUMBER,
                                   K_DESCERROR       OUT VARCHAR2)

    IS
    P_MES VARCHAR(20);
  BEGIN
    P_MES := TO_CHAR(SYSDATE, 'YYYYMM');

    K_FECHAVENCIMIENTO := LAST_DAY(SYSDATE);

    SELECT SUM(SLD_PUNTO)
        INTO K_PTOSPORVENCER
        FROM (SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_SLD_PUNTO), 0)),
                            -1,
                            NVL(SUM(K.ADMPN_SLD_PUNTO), 0) * -1,
                            NVL(SUM(K.ADMPN_SLD_PUNTO), 0)) as SLD_PUNTO
                                FROM ADMPT_CLIENTE C,ADMPT_KARDEX K
                               WHERE C.ADMPV_TIPO_DOC = K_TIPODOC
                                 AND C.ADMPV_NUM_DOC = K_NRODOC
                                 AND C.ADMPV_COD_CLI = K.ADMPV_COD_CLI
                                 AND K.ADMPC_TPO_OPER = 'E'
                                 AND K.ADMPN_SLD_PUNTO > 0
                                 AND K.ADMPC_TPO_PUNTO IN ('I', 'L', 'C')
                                 AND K.ADMPD_FEC_TRANS >=
                                 ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -17)
                                 AND K.ADMPD_FEC_TRANS <
                                 ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -16)
                UNION
                        SELECT DECODE(SIGN(NVL(SUM(K.ADMPN_SLD_PUNTO), 0)),
                                  -1,
                                  NVL(SUM(K.ADMPN_SLD_PUNTO), 0) * -1,
                                  NVL(SUM(K.ADMPN_SLD_PUNTO), 0)) AS SLD_PUNTO
                               FROM  ADMPT_CLIENTEFIJA     C,
                                     ADMPT_KARDEXFIJA      K,
                                     ADMPT_CLIENTEPRODUCTO P
                               WHERE C.ADMPV_TIPO_DOC =K_TIPODOC
                                 AND C.ADMPV_NUM_DOC =K_NRODOC
                                 AND C.ADMPV_COD_CLI = P.ADMPV_COD_CLI
                                 AND P.ADMPV_COD_CLI_PROD = K.ADMPV_COD_CLI_PROD
                                 AND K.ADMPC_TPO_OPER = 'E'
                                 AND K.ADMPN_SLD_PUNTO > 0
                                 AND K.ADMPC_TPO_PUNTO IN ('I', 'L', 'C')
                                AND K.ADMPD_FEC_TRANS >=
                                ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -17)
                               AND K.ADMPD_FEC_TRANS <
                               ADD_MONTHS(TO_DATE(P_MES || '01', 'YYYYMMDD'), -16));

    K_CODERROR := 0;
    K_DESCERROR:= 'OK';

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
          K_PTOSPORVENCER := 0;
          K_CODERROR := 0;
          K_DESCERROR:= 'OK';
        WHEN OTHERS THEN
          K_CODERROR        := 1;
          K_DESCERROR       := 'NO OK';
          K_PTOSPORVENCER := 0;

  END MICLSS_CLARO_PUNTOS;
   
END PKG_CC_CONSULTA;
/